<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This guide helps you debug communication issues between the Kubernetes API server and the cert-manager webhook Pod."><meta name=author content="James Munnelly"><link href=https://cert-manager.io/troubleshooting/webhook/ rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-8.5.10"><title>The Definitive Debugging Guide for the cert-manager Webhook Pod - cert-manager</title><link rel=stylesheet href=../../assets/stylesheets/main.975780f9.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#error-connect-connection-refused class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../.. title=cert-manager class="md-header__button md-logo" aria-label=cert-manager data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> cert-manager </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> The Definitive Debugging Guide for the cert-manager Webhook Pod </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/cert-manager/cert-manager title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> cert-manager/cert-manager </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> 简介 </a> </li> <li class=md-tabs__item> <a href=../../installation/ class=md-tabs__link> 安装 </a> </li> <li class=md-tabs__item> <a href=../../configuration/ class=md-tabs__link> 配置 </a> </li> <li class=md-tabs__item> <a href=../../usage/ class=md-tabs__link> 使用 </a> </li> <li class=md-tabs__item> <a href=../../tutorials/ class=md-tabs__link> 手册 </a> </li> <li class=md-tabs__item> <a href=../../projects/ class=md-tabs__link> 项目 </a> </li> <li class=md-tabs__item> <a href=../ class="md-tabs__link md-tabs__link--active"> 故障排除 </a> </li> <li class=md-tabs__item> <a href=../../concepts/ class=md-tabs__link> 概念 </a> </li> <li class=md-tabs__item> <a href=../../reference/ class=md-tabs__link> 参考 </a> </li> <li class=md-tabs__item> <a href=../../contributing/ class=md-tabs__link> 贡献 </a> </li> <li class=md-tabs__item> <a href=../../release-notes/ class=md-tabs__link> 发布说明 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=cert-manager class="md-nav__button md-logo" aria-label=cert-manager data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> cert-manager </label> <div class=md-nav__source> <a href=https://github.com/cert-manager/cert-manager title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> cert-manager/cert-manager </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <div class="md-nav__link md-nav__link--index "> <a href=../..>简介</a> <label for=__nav_1> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=简介 data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> 简介 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/ class=md-nav__link> 入门 </a> </li> <li class=md-nav__item> <a href=../../faq/ class=md-nav__link> FAQ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <div class="md-nav__link md-nav__link--index "> <a href=../../installation/ >安装</a> <label for=__nav_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=安装 data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 安装 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../installation/supported-releases/ class=md-nav__link> 支持版本 </a> </li> <li class=md-nav__item> <a href=../../installation/compatibility/ class=md-nav__link> 云兼容性 </a> </li> <li class=md-nav__item> <a href=../../installation/kubectl/ class=md-nav__link> kubectl apply </a> </li> <li class=md-nav__item> <a href=../../installation/helm/ class=md-nav__link> Helm </a> </li> <li class=md-nav__item> <a href=../../installation/operator-lifecycle-manager/ class=md-nav__link> OperatorHub (OLM) </a> </li> <li class=md-nav__item> <a href=../../installation/other-tools/ class=md-nav__link> 其他工具 </a> </li> <li class=md-nav__item> <a href=../../installation/verify/ class=md-nav__link> 验证 </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_9 type=checkbox id=__nav_2_9> <div class="md-nav__link md-nav__link--index "> <a href=../../installation/upgrading/ >更新</a> <label for=__nav_2_9> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=更新 data-md-level=2> <label class=md-nav__title for=__nav_2_9> <span class="md-nav__icon md-icon"></span> 更新 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../installation/upgrading/ingress-class-compatibility/ class=md-nav__link> 关于入类兼容性的说明 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/remove-deprecated-apis/ class=md-nav__link> 迁移废弃的API源 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-1.9-1.10/ class=md-nav__link> v1.9 to v1.10 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-1.8-1.9/ class=md-nav__link> v1.8 to v1.9 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-1.7-1.8/ class=md-nav__link> v1.7 to v1.8 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-1.6-1.7/ class=md-nav__link> v1.6 to v1.7 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-1.5-1.6/ class=md-nav__link> v1.5 to v1.6 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-1.4-1.5/ class=md-nav__link> v1.4 to v1.5 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-1.3-1.4/ class=md-nav__link> v1.3 to v1.4 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-1.2-1.3/ class=md-nav__link> v1.2 to v1.3 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-1.1-1.2/ class=md-nav__link> v1.1 to v1.2 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-1.0-1.1/ class=md-nav__link> v1.0 to v1.1 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.16-1.0/ class=md-nav__link> v0.16 to v1.0 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.15-0.16/ class=md-nav__link> v0.15 to v0.16 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.14-0.15/ class=md-nav__link> v0.14 to v0.15 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.13-0.14/ class=md-nav__link> v0.13 to v0.14 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.12-0.13/ class=md-nav__link> v0.12 to v0.13 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.11-0.12/ class=md-nav__link> v0.11 to v0.12 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.10-0.11/ class=md-nav__link> v0.10 to v0.11 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.9-0.10/ class=md-nav__link> v0.9 to v0.10 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.8-0.9/ class=md-nav__link> v0.8 to v0.9 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.7-0.8/ class=md-nav__link> v0.7 to v0.8 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.6-0.7/ class=md-nav__link> v0.6 to v0.7 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.5-0.6/ class=md-nav__link> v0.5 to v0.6 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.4-0.5/ class=md-nav__link> v0.4 to v0.5 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.3-0.4/ class=md-nav__link> v0.3 to v0.4 </a> </li> <li class=md-nav__item> <a href=../../installation/upgrading/upgrading-0.2-0.3/ class=md-nav__link> v0.2 to v0.3 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../installation/uninstall/ class=md-nav__link> 卸载 </a> </li> <li class=md-nav__item> <a href=../../installation/api-compatibility/ class=md-nav__link> API兼容性 </a> </li> <li class=md-nav__item> <a href=../../installation/code-signing/ class=md-nav__link> 签名验证 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <div class="md-nav__link md-nav__link--index "> <a href=../../configuration/ >配置</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=配置 data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 配置 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2> <div class="md-nav__link md-nav__link--index "> <a href=../../configuration/acme/ >ACME</a> <label for=__nav_3_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=ACME data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> ACME </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_2 type=checkbox id=__nav_3_2_2> <div class="md-nav__link md-nav__link--index "> <a href=../../configuration/acme/http01/ >HTTP01</a> <label for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=HTTP01 data-md-level=3> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> HTTP01 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../configuration/acme/http01/externalloadbalancer/ class=md-nav__link> 外部负载均衡器 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2_3 type=checkbox id=__nav_3_2_3> <div class="md-nav__link md-nav__link--index "> <a href=../../configuration/acme/dns01/ >DNS01</a> <label for=__nav_3_2_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=DNS01 data-md-level=3> <label class=md-nav__title for=__nav_3_2_3> <span class="md-nav__icon md-icon"></span> DNS01 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../configuration/acme/dns01/acme-dns/ class=md-nav__link> ACMEDNS </a> </li> <li class=md-nav__item> <a href=../../configuration/acme/dns01/akamai/ class=md-nav__link> Akamai </a> </li> <li class=md-nav__item> <a href=../../configuration/acme/dns01/azuredns/ class=md-nav__link> AzureDNS </a> </li> <li class=md-nav__item> <a href=../../configuration/acme/dns01/cloudflare/ class=md-nav__link> Cloudflare </a> </li> <li class=md-nav__item> <a href=../../configuration/acme/dns01/digitalocean/ class=md-nav__link> DigitalOcean </a> </li> <li class=md-nav__item> <a href=../../configuration/acme/dns01/google/ class=md-nav__link> Google CloudDNS </a> </li> <li class=md-nav__item> <a href=../../configuration/acme/dns01/rfc2136/ class=md-nav__link> RFC-2136 </a> </li> <li class=md-nav__item> <a href=../../configuration/acme/dns01/route53/ class=md-nav__link> Route53 </a> </li> <li class=md-nav__item> <a href=../../configuration/acme/dns01/webhook/ class=md-nav__link> Webhook </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../configuration/selfsigned/ class=md-nav__link> SelfSigned </a> </li> <li class=md-nav__item> <a href=../../configuration/ca/ class=md-nav__link> CA </a> </li> <li class=md-nav__item> <a href=../../configuration/vault/ class=md-nav__link> Vault </a> </li> <li class=md-nav__item> <a href=../../configuration/venafi/ class=md-nav__link> Venafi </a> </li> <li class=md-nav__item> <a href=../../configuration/external/ class=md-nav__link> External </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <div class="md-nav__link md-nav__link--index "> <a href=../../usage/ >使用</a> <label for=__nav_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=使用 data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 使用 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../usage/certificate/ class=md-nav__link> 证书源 </a> </li> <li class=md-nav__item> <a href=../../usage/ingress/ class=md-nav__link> 保护入口源 </a> </li> <li class=md-nav__item> <a href=../../usage/gateway/ class=md-nav__link> 保护网关源 </a> </li> <li class=md-nav__item> <a href=../../usage/prometheus-metrics/ class=md-nav__link> Prometheus Metrics </a> </li> <li class=md-nav__item> <a href=../../usage/istio/ class=md-nav__link> 保护Istio服务网格 </a> </li> <li class=md-nav__item> <a href=../../usage/csi/ class=md-nav__link> CSI驱动 </a> </li> <li class=md-nav__item> <a href=../../usage/kube-csr/ class=md-nav__link> Kubernetes CertificateSigningRequests </a> </li> <li class=md-nav__item> <a href=../../usage/approver-policy/ class=md-nav__link> cert-manager 证书的策略 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <div class="md-nav__link md-nav__link--index "> <a href=../../tutorials/ >手册</a> <label for=__nav_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=手册 data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> 手册 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tutorials/acme/http-validation/ class=md-nav__link> HTTP 验证 </a> </li> <li class=md-nav__item> <a href=../../tutorials/acme/dns-validation/ class=md-nav__link> DNS 验证 </a> </li> <li class=md-nav__item> <a href=../../tutorials/acme/nginx-ingress/ class=md-nav__link> NGINX-ingress </a> </li> <li class=md-nav__item> <a href=../../tutorials/backup/ class=md-nav__link> 备份恢复源 </a> </li> <li class=md-nav__item> <a href=../../tutorials/syncing-secrets-across-namespaces/ class=md-nav__link> 跨命名空间同步秘密 </a> </li> <li class=md-nav__item> <a href=../../tutorials/istio-csr/istio-csr/ class=md-nav__link> 保护istio Service Mesh </a> </li> <li class=md-nav__item> <a href=../../tutorials/getting-started-with-cert-manager-on-google-kubernetes-engine-using-lets-encrypt-for-ingress-ssl/ class=md-nav__link> GKE+Ingress+Let's Encrypt </a> </li> <li class=md-nav__item> <a href=../../tutorials/acme/migrating-from-kube-lego/ class=md-nav__link> 迁移Kube-LEGO </a> </li> <li class=md-nav__item> <a href=../../tutorials/acme/pomerium-ingress/ class=md-nav__link> Pomerium Ingress </a> </li> <li class=md-nav__item> <a href=../../tutorials/venafi/venafi/ class=md-nav__link> EKS+Ingress+Venafi </a> </li> <li class=md-nav__item> <a href=../../tutorials/zerossl/zerossl/ class=md-nav__link> 用ZeroSSL保护入口 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <div class="md-nav__link md-nav__link--index "> <a href=../../projects/ >项目</a> <label for=__nav_6> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=项目 data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 项目 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../projects/istio-csr/ class=md-nav__link> istio-csr </a> </li> <li class=md-nav__item> <a href=../../projects/csi-driver/ class=md-nav__link> csi-driver </a> </li> <li class=md-nav__item> <a href=../../projects/csi-driver-spiffe/ class=md-nav__link> csi-driver-spiffe </a> </li> <li class=md-nav__item> <a href=../../projects/approver-policy/ class=md-nav__link> approver-policy </a> </li> <li class=md-nav__item> <a href=../../projects/trust-manager/ class=md-nav__link> trust-manager </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7 checked> <div class="md-nav__link md-nav__link--index "> <a href=../ >故障排除</a> <label for=__nav_7> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=故障排除 data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> 故障排除 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../acme/ class=md-nav__link> ACME/Let's Encrypt 证书故障处理 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> webhook故障处理 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> webhook故障处理 </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#error-connect-connection-refused class=md-nav__link> Error: connect: connection refused </a> </li> <li class=md-nav__item> <a href=#error-io-timeout-connectivity-issue class=md-nav__link> Error: i/o timeout (connectivity issue) </a> <nav class=md-nav aria-label="Error: i/o timeout (connectivity issue)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cause-1-gke-private-cluster class=md-nav__link> Cause 1: GKE Private Cluster </a> </li> <li class=md-nav__item> <a href=#cause-2-eks-on-a-custom-cni class=md-nav__link> Cause 2: EKS on a custom CNI </a> </li> <li class=md-nav__item> <a href=#cause-3-network-policies-calico class=md-nav__link> Cause 3: Network Policies, Calico </a> </li> <li class=md-nav__item> <a href=#cause-4-eks-and-security-groups class=md-nav__link> Cause 4: EKS and Security Groups </a> </li> <li class=md-nav__item> <a href=#other-causes class=md-nav__link> Other causes </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#error-x509-certificate-is-valid-for-xxxinternal-not-cert-manager-webhookcert-managersvc-eks-with-fargate-pods class=md-nav__link> Error: x509: certificate is valid for xxx.internal, not cert-manager-webhook.cert-manager.svc (EKS with Fargate pods) </a> </li> <li class=md-nav__item> <a href=#error-service-cert-managercert-manager-webhook-not-found class=md-nav__link> Error: service "cert-managercert-manager-webhook" not found </a> </li> <li class=md-nav__item> <a href=#error-no-endpoints-available-for-service-cert-manager-webhook-ovhcloud class=md-nav__link> Error: no endpoints available for service "cert-manager-webhook" (OVHCloud) </a> </li> <li class=md-nav__item> <a href=#error-x509-certificate-has-expired-or-is-not-yet-valid class=md-nav__link> Error: x509: certificate has expired or is not yet valid </a> </li> <li class=md-nav__item> <a href=#error-nethttp-request-canceled-while-waiting-for-connection class=md-nav__link> Error: net/http: request canceled while waiting for connection </a> </li> <li class=md-nav__item> <a href=#error-context-deadline-exceeded class=md-nav__link> Error: context deadline exceeded </a> </li> <li class=md-nav__item> <a href=#error-nethttp-tls-handshake-timeout class=md-nav__link> Error: net/http: TLS handshake timeout </a> </li> <li class=md-nav__item> <a href=#error-http-probe-failed-with-statuscode-500 class=md-nav__link> Error: HTTP probe failed with statuscode: 500 </a> </li> <li class=md-nav__item> <a href=#error-service-unavailable class=md-nav__link> Error: Service Unavailable </a> </li> <li class=md-nav__item> <a href=#error-failed-calling-admission-webhook-the-server-is-currently-unable-to-handle-the-request class=md-nav__link> Error: failed calling admission webhook: the server is currently unable to handle the request </a> </li> <li class=md-nav__item> <a href=#error-x509-certificate-signed-by-unknown-authority class=md-nav__link> Error: x509: certificate signed by unknown authority </a> </li> <li class=md-nav__item> <a href=#error-cluster-scoped-resource-mutatingwebhookconfigurations-is-managed-and-access-is-denied class=md-nav__link> Error: cluster scoped resource "mutatingwebhookconfigurations/" is managed and access is denied </a> </li> <li class=md-nav__item> <a href=#error-the-namespace-kube-system-is-managed-and-the-requests-verb-create-is-denied class=md-nav__link> Error: the namespace "kube-system" is managed and the request's verb "create" is denied </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <div class="md-nav__link md-nav__link--index "> <a href=../../concepts/ >概念</a> <label for=__nav_8> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=概念 data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> 概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../concepts/issuer/ class=md-nav__link> Issuer(颁发者) </a> </li> <li class=md-nav__item> <a href=../../concepts/certificate/ class=md-nav__link> Certificate(证书) </a> </li> <li class=md-nav__item> <a href=../../concepts/certificaterequest/ class=md-nav__link> CertificateRequest(证书请求) </a> </li> <li class=md-nav__item> <a href=../../concepts/acme-orders-challenges/ class=md-nav__link> ACME Orders(命令)和Challenges(挑战) </a> </li> <li class=md-nav__item> <a href=../../concepts/webhook/ class=md-nav__link> Webhook(Web钩子) </a> </li> <li class=md-nav__item> <a href=../../concepts/ca-injector/ class=md-nav__link> CA Injector(CA 注射器) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <div class="md-nav__link md-nav__link--index "> <a href=../../reference/ >参考</a> <label for=__nav_9> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=参考 data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> 参考 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/cmctl/ class=md-nav__link> 命令行工具 (cmctl) </a> </li> <li class=md-nav__item> <a href=../../reference/tls-terminology/ class=md-nav__link> TLS 术语 </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9_4 type=checkbox id=__nav_9_4> <div class="md-nav__link md-nav__link--index "> <a href=../../cli/ >组件/ Docker映像</a> <label for=__nav_9_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="组件/ Docker映像" data-md-level=2> <label class=md-nav__title for=__nav_9_4> <span class="md-nav__icon md-icon"></span> 组件/ Docker映像 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cli/acmesolver/ class=md-nav__link> acmesolver </a> </li> <li class=md-nav__item> <a href=../../cli/cainjector/ class=md-nav__link> cainjector </a> </li> <li class=md-nav__item> <a href=../../cli/cmctl/ class=md-nav__link> cmctl </a> </li> <li class=md-nav__item> <a href=../../cli/controller/ class=md-nav__link> controller </a> </li> <li class=md-nav__item> <a href=../../cli/webhook/ class=md-nav__link> webhook </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../reference/api-docs/ class=md-nav__link> API 参考 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10 type=checkbox id=__nav_10> <div class="md-nav__link md-nav__link--index "> <a href=../../contributing/ >贡献</a> <label for=__nav_10> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=贡献 data-md-level=1> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> 贡献 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../contributing/policy/ class=md-nav__link> 功能政策 </a> </li> <li class=md-nav__item> <a href=../../contributing/building/ class=md-nav__link> 构建 cert-manager </a> </li> <li class=md-nav__item> <a href=../../contributing/contributing-flow/ class=md-nav__link> 流的贡献 </a> </li> <li class=md-nav__item> <a href=../../contributing/crds/ class=md-nav__link> CRDs </a> </li> <li class=md-nav__item> <a href=../../contributing/dns-providers/ class=md-nav__link> DNS Providers </a> </li> <li class=md-nav__item> <a href=../../contributing/e2e/ class=md-nav__link> 运行端到端测试 </a> </li> <li class=md-nav__item> <a href=../../contributing/external-issuers/ class=md-nav__link> 实施外部发行人 </a> </li> <li class=md-nav__item> <a href=../../contributing/sign-off/ class=md-nav__link> DCO签署 </a> </li> <li class=md-nav__item> <a href=../../contributing/release-process/ class=md-nav__link> 发布过程 </a> </li> <li class=md-nav__item> <a href=../../contributing/kind/ class=md-nav__link> 与人为善 </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10_12 type=checkbox id=__nav_10_12> <div class="md-nav__link md-nav__link--index "> <a href=../../contributing/google-season-of-docs/ >谷歌文档季</a> <label for=__nav_10_12> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=谷歌文档季 data-md-level=2> <label class=md-nav__title for=__nav_10_12> <span class="md-nav__icon md-icon"></span> 谷歌文档季 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10_12_2 type=checkbox id=__nav_10_12_2> <div class="md-nav__link md-nav__link--index "> <a href=../../contributing/google-season-of-docs/2022/ >2022</a> <label for=__nav_10_12_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=2022 data-md-level=3> <label class=md-nav__title for=__nav_10_12_2> <span class="md-nav__icon md-icon"></span> 2022 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../contributing/google-season-of-docs/2022/improve-navigation-and-structure/ class=md-nav__link> 改进cert-manager网站的导航和结构 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../contributing/security/ class=md-nav__link> 报告安全问题 </a> </li> <li class=md-nav__item> <a href=../../contributing/coding-conventions/ class=md-nav__link> 代码编写约定 </a> </li> <li class=md-nav__item> <a href=../../contributing/third-party-code-donation/ class=md-nav__link> 第三方代码捐赠 </a> </li> <li class=md-nav__item> <a href=../../contributing/signing-keys/ class=md-nav__link> 签名密钥 </a> </li> <li class=md-nav__item> <a href=../../contributing/importing/ class=md-nav__link> 在Go中导入证书管理器 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11 type=checkbox id=__nav_11> <div class="md-nav__link md-nav__link--index "> <a href=../../release-notes/ >发布说明</a> <label for=__nav_11> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=发布说明 data-md-level=1> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> 发布说明 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../release-notes/release-notes-1.10/ class=md-nav__link> v1.10 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-1.9/ class=md-nav__link> v1.9 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-1.8/ class=md-nav__link> v1.8 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-1.7/ class=md-nav__link> v1.7 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-1.6/ class=md-nav__link> v1.6 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-1.5/ class=md-nav__link> v1.5 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-1.4/ class=md-nav__link> v1.4 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-1.3/ class=md-nav__link> v1.3 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-1.2/ class=md-nav__link> v1.2 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-1.1/ class=md-nav__link> v1.1 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-1.0/ class=md-nav__link> v1.0 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.16/ class=md-nav__link> v0.16 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.15/ class=md-nav__link> v0.15 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.14/ class=md-nav__link> v0.14 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.13/ class=md-nav__link> v0.13 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.12/ class=md-nav__link> v0.12 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.11/ class=md-nav__link> v0.11 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.10/ class=md-nav__link> v0.10 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.9/ class=md-nav__link> v0.9 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.8/ class=md-nav__link> v0.8 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.7/ class=md-nav__link> v0.7 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.6/ class=md-nav__link> v0.6 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.5/ class=md-nav__link> v0.5 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.4/ class=md-nav__link> v0.4 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.3/ class=md-nav__link> v0.3 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.2/ class=md-nav__link> v0.2 </a> </li> <li class=md-nav__item> <a href=../../release-notes/release-notes-0.1/ class=md-nav__link> v0.1 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#error-connect-connection-refused class=md-nav__link> Error: connect: connection refused </a> </li> <li class=md-nav__item> <a href=#error-io-timeout-connectivity-issue class=md-nav__link> Error: i/o timeout (connectivity issue) </a> <nav class=md-nav aria-label="Error: i/o timeout (connectivity issue)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cause-1-gke-private-cluster class=md-nav__link> Cause 1: GKE Private Cluster </a> </li> <li class=md-nav__item> <a href=#cause-2-eks-on-a-custom-cni class=md-nav__link> Cause 2: EKS on a custom CNI </a> </li> <li class=md-nav__item> <a href=#cause-3-network-policies-calico class=md-nav__link> Cause 3: Network Policies, Calico </a> </li> <li class=md-nav__item> <a href=#cause-4-eks-and-security-groups class=md-nav__link> Cause 4: EKS and Security Groups </a> </li> <li class=md-nav__item> <a href=#other-causes class=md-nav__link> Other causes </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#error-x509-certificate-is-valid-for-xxxinternal-not-cert-manager-webhookcert-managersvc-eks-with-fargate-pods class=md-nav__link> Error: x509: certificate is valid for xxx.internal, not cert-manager-webhook.cert-manager.svc (EKS with Fargate pods) </a> </li> <li class=md-nav__item> <a href=#error-service-cert-managercert-manager-webhook-not-found class=md-nav__link> Error: service "cert-managercert-manager-webhook" not found </a> </li> <li class=md-nav__item> <a href=#error-no-endpoints-available-for-service-cert-manager-webhook-ovhcloud class=md-nav__link> Error: no endpoints available for service "cert-manager-webhook" (OVHCloud) </a> </li> <li class=md-nav__item> <a href=#error-x509-certificate-has-expired-or-is-not-yet-valid class=md-nav__link> Error: x509: certificate has expired or is not yet valid </a> </li> <li class=md-nav__item> <a href=#error-nethttp-request-canceled-while-waiting-for-connection class=md-nav__link> Error: net/http: request canceled while waiting for connection </a> </li> <li class=md-nav__item> <a href=#error-context-deadline-exceeded class=md-nav__link> Error: context deadline exceeded </a> </li> <li class=md-nav__item> <a href=#error-nethttp-tls-handshake-timeout class=md-nav__link> Error: net/http: TLS handshake timeout </a> </li> <li class=md-nav__item> <a href=#error-http-probe-failed-with-statuscode-500 class=md-nav__link> Error: HTTP probe failed with statuscode: 500 </a> </li> <li class=md-nav__item> <a href=#error-service-unavailable class=md-nav__link> Error: Service Unavailable </a> </li> <li class=md-nav__item> <a href=#error-failed-calling-admission-webhook-the-server-is-currently-unable-to-handle-the-request class=md-nav__link> Error: failed calling admission webhook: the server is currently unable to handle the request </a> </li> <li class=md-nav__item> <a href=#error-x509-certificate-signed-by-unknown-authority class=md-nav__link> Error: x509: certificate signed by unknown authority </a> </li> <li class=md-nav__item> <a href=#error-cluster-scoped-resource-mutatingwebhookconfigurations-is-managed-and-access-is-denied class=md-nav__link> Error: cluster scoped resource "mutatingwebhookconfigurations/" is managed and access is denied </a> </li> <li class=md-nav__item> <a href=#error-the-namespace-kube-system-is-managed-and-the-requests-verb-create-is-denied class=md-nav__link> Error: the namespace "kube-system" is managed and the request's verb "create" is denied </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/cert-manager/cert-manager/edit/master/docs/troubleshooting/webhook.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>webhook故障处理</h1> <blockquote> <p>Last verified: 8 Sept 2022</p> </blockquote> <p>The cert-manager webhook is a pod that runs as part of your cert-manager installation. When applying a manifest with <code>kubectl</code>, the Kubernetes API server calls the cert-manager webhook over TLS to validate your manifests. This guide helps you debug communication issues between the Kubernetes API server and the cert-manager webhook pod.</p> <p>The error messages listed in this page are encountered while installing or upgrading cert-manager, or shortly after installing or upgrading cert-manager when trying to create a Certificate, Issuer, or any other cert-manager custom resource.</p> <p>In the below diagram, we show the common pattern when debugging an issue with the cert-manager webhook: when creating a cert-manager custom resource, the API server connects over TLS to the cert-manager webhook pod. The red cross indicates that the API server fails talking to the webhook.</p> <p><img alt="Diagram that shows a kubectl command that aims to create an issuer resource, and an arrow towards the Kubernetes API server, and an arrow between the API server and the webhook that indicates that the API server tries to connect to the webhook. This last arrow is crossed in red." src=/images/troubleshooting/webhook-pod-networking-diagram.png width=500></p> <p>The rest of this document presents error messages you may encounter.</p> <h2 id=error-connect-connection-refused>Error: <code>connect: connection refused</code><a class=headerlink href=#error-connect-connection-refused title="Permanent link">&para;</a></h2> <blockquote> <p>This issue was reported in 4 GitHub issues (<a href=https://github.com/jetstack/cert-manager/issues/2736 title="Getting WebHook Connection Refused error when using Azure DevOps Pipelines">#2736</a>, <a href=https://github.com/jetstack/cert-manager/issues/3133 title="Failed calling webhook webhook.cert-manager.io: connect: connection refused">#3133</a>, <a href=https://github.com/jetstack/cert-manager/issues/3445 title="Connection refused for cert-manager-webhook service">#3445</a>, <a href=https://github.com/cert-manager/cert-manager/issues/4425 title="Webhook error">#4425</a>), was reported in 1 GitHub issue in an external project (<a href=https://github.com/kubernetes-sigs/aws-load-balancer-controller/issues/1563 title="Internal error occurred: failed calling webhook webhook.cert-manager.io, no endpoints available"><code>aws-load-balancer-controller#1563</code></a>), on Stack Overflow (<a href=https://web.archive.org/web/20210903183221/https://serverfault.com/questions/1076563/creating-issuer-for-kubernetes-cert-manager-is-causing-404-and-500-error title="Creating issuer for kubernetes cert-manager is causing 404 and 500 error"><code>serverfault#1076563</code></a>), and was mentioned in 13 Slack messages that can be listed with the search <code>in:#cert-manager in:#cert-manager-dev ":443: connect: connection refused"</code>. This error message can also be found in other projects that are building webhooks (<a href=https://github.com/kubewarden/kubewarden-controller/issues/110 title="Investigate failure on webhooks not ready when installing cert-manager from helm chart: connection refused"><code>kubewarden-controller#110</code></a>).</p> </blockquote> <p>Shortly after installing or upgrading cert-manager, you may hit this error when creating a Certificate, Issuer, or any other cert-manager custom resource. For example, creating an Issuer resource with the following command:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>kubectl apply -f- <span class=s>&lt;&lt;EOF</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=s>apiVersion: cert-manager.io/v1</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=s>kind: Issuer</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=s>metadata:</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=s>  name: example</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=s>spec:</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=s>  selfSigned: {}</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=s>EOF</span>
</code></pre></div> <p>shows the following error message:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>Error from server (InternalError): error when creating &quot;STDIN&quot;:
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>  Internal error occurred: failed calling webhook &quot;webhook.cert-manager.io&quot;: failed to call webhook:
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>    Post &quot;https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=10s&quot;:
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>      dial tcp 10.96.20.99:443: connect: connection refused
</code></pre></div> <p>When installing or upgrading cert-manager 1.5.0 and above with Helm, a very similar error message may appear when running <code>helm install</code> or <code>helm upgrade</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>Error: INSTALLATION FAILED: Internal error occurred:
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>  failed calling webhook &quot;webhook.cert-manager.io&quot;: failed to call webhook:
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>    Post &quot;https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=10s&quot;:
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>      dial tcp 10.96.20.99:443: connect: connection refused
</code></pre></div> <p>The message "connection refused" happens when the API server tries to establish a TCP connection with the cert-manager-webhook. In TCP terms, the API server sent the <code>SYN</code> packet to start the TCP handshake, and received an <code>RST</code> packet in return.</p> <p>If we were to use <a href=https://www.tcpdump.org/manpages/tcpdump.1.html><code>tcpdump</code></a> inside the control plane node where the API server is running, we would see a packet returned to the API server:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>192.168.1.43 (apiserver)   -&gt; 10.96.20.99 (webhook pod)  TCP   59466 → 443 [SYN]
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>10.96.20.99  (webhook pod) -&gt; 192.168.1.43 (apiserver)   TCP   443 → 59466 [RST, ACK]
</code></pre></div> <p>The <code>RST</code> packet is sent by the Linux kernel when nothing is listening to the requested port. The <code>RST</code> packet can also be returned by one of the TCP hops, e.g., a firewall, as detailed in the Stack Overflow page <a href=https://stackoverflow.com/a/2333446/3808537>What can be the reasons of connection refused errors?</a></p> <p>Note that firewalls usually don't return an <code>RST</code> packet; they usually drop the <code>SYN</code> packet entirely, and you end up with the error message <code>i/o timeout</code> or <code>context deadline exceeded</code>. If that is the case, continue your investigation with the section <a href=#io-timeout>Error: <code>i/o timeout</code> (connectivity issue)</a> and <a href=#context-deadline-exceeded>Error: <code>context deadline exceeded</code></a> respectively.</p> <p>Let's eliminate the possible causes from the closest to the source of the TCP connection (the API server) to its destination (the pod <code>cert-manager-webhook</code>).</p> <p>Let's imagine that the name <code>cert-manager-webhook.cert-manager.svc</code> was resolved to 10.43.183.232. This is a cluster IP. The control plane node, in which the API server process runs, uses its iptables to rewrite the IP destination using the pod IP. That might be the first problem: sometimes, no pod IP is associated with a given cluster IP because the kubelet doesn't fill in the Endpoint resource with pod IPs as long as the readiness probe doesn't work.</p> <p>Let us first check whether it is a problem with the Endpoint resource:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>kubectl get endpoints -n cert-manager cert-manager-webhook
</code></pre></div> <p>A valid output would look like this:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>NAME                   ENDPOINTS           AGE
<a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>cert-manager-webhook   10.244.0.2:10250    27d    ✅
</code></pre></div> <p>If you have this valid output and have the <code>connect: connection refused</code>, then the issue is deeper in the networking stack. We won't dig into this case, but you might want to use <code>tcpdump</code> and Wireshark to see whether traffic properly flows from the API server to the node's host namespace. The traffic from the host namespace to the pod's namespace already works fine since the kubelet was already able to reach the readiness endpoint.</p> <p>Common issues include firewall dropping traffic from the control plane to workers; for example, the API server on GKE is only allowed to talk to worker nodes (which is where the cert-manager webhook is running) over port <code>10250</code>. In EKS, your security groups might deny traffic from your control plane VPC towards your workers VPC over TCP <code>10250</code>.</p> <p>If you see <code>&lt;none&gt;</code>, it indicates that the cert-manager webhook is properly running but its readiness endpoint can't be reached:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>NAME                   ENDPOINTS           AGE
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>cert-manager-webhook   &lt;none&gt;              236d   ❌
</code></pre></div> <p>To fix <code>&lt;none&gt;</code>, you will have to check whether the cert-manager-webhook deployment is healthy. The endpoints stays at <code>&lt;none&gt;</code> while the cert-manager-webhook isn't marked as <code>healthy</code>.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>kubectl get pod -n cert-manager -l app.kubernetes.io/name<span class=o>=</span>webhook
</code></pre></div> <p>You should see that the pod is <code>Running</code>, and that the number of containers that are ready is <code>0/1</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>NAME                            READY   STATUS    RESTARTS     AGE
<a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>cert-manager-76578c9687-24kmr   0/1     Running   7 (8h ago)   28d  ❌
</code></pre></div> <p>We won't be detailing the case where you get <code>1/1</code> and <code>Running</code>, since it would indicate an inconsistent state in Kubernetes.</p> <p>Continuing with <code>0/1</code>, that means the readiness endpoint isn't answering. When that happens, no endpoint is created. The next step is to figure out why the readiness endpoint isn't answering. Let us see which port the kubelet is using when hitting the readiness endpoint:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>kubectl -n cert-manager get deploy cert-manager-webhook -oyaml <span class=p>|</span> grep -A5 readiness
</code></pre></div> <p>In our example, the port that the kubelet will try to hit is 6080:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=nt>readinessProbe</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=w>  </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class=w></span>
<a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>  </span><span class=nt>httpGet</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/healthz</span><span class=w></span>
<a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">6080</span><span class=w> </span><span class=c1># ✨</span><span class=w></span>
<a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>    </span><span class=nt>scheme</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HTTP</span><span class=w></span>
</code></pre></div> <p>Now, let us port-forward to that port and see if <code>/healthz</code> works. In a shell session, run:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>kubectl -n cert-manager port-forward deploy/cert-manager-webhook <span class=m>6080</span>
</code></pre></div> <p>In another shell session, run:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>curl -sS --dump-header - <span class=m>127</span>.0.0.1:6080/healthz
</code></pre></div> <p>The happy output is:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK ✅</span>
<a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=na>Date</span><span class=o>:</span> <span class=l>Tue, 07 Jun 2022 17:16:56 GMT</span>
<a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=na>Content-Length</span><span class=o>:</span> <span class=l>0</span>
</code></pre></div> <p>If the readiness endpoint doesn't work, you will see:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>curl: (7) Failed to connect to 127.0.0.1 port 6080 after 0 ms: Connection refused ❌
</code></pre></div> <p>At this point, verify that the readiness endpoint is configured on that same port. Let us see the logs to check that our webhook is listening on 6080 for its readiness endpoint:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=gp>$ </span>kubectl logs -n cert-manager -l app.kubernetes.io/name<span class=o>=</span>webhook <span class=p>|</span> head -10
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=go>I0607 webhook.go:129] &quot;msg&quot;=&quot;using dynamic certificate generating using CA stored in Secret resource&quot;</span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=go>I0607 server.go:133] &quot;msg&quot;=&quot;listening for insecure healthz connections&quot;  &quot;address&quot;=&quot;:6081&quot; ❌</span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=go>I0607 server.go:197] &quot;msg&quot;=&quot;listening for secure connections&quot;  &quot;address&quot;=&quot;:10250&quot;</span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=go>I0607 dynamic_source.go:267] &quot;msg&quot;=&quot;Updated serving TLS certificate&quot;</span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=go>...</span>
</code></pre></div> <p>In the above example, the issue was a misconfiguration of the readiness port. In the webhook deployment, the argument <code>--healthz-port=6081</code> was mismatched with the readiness configuration.</p> <p><a id=io-timeout></a></p> <h2 id=error-io-timeout-connectivity-issue>Error: <code>i/o timeout</code> (connectivity issue)<a class=headerlink href=#error-io-timeout-connectivity-issue title="Permanent link">&para;</a></h2> <blockquote> <p>This error message was reported 26 times on Slack. To list these messages, do a search with <code>in:#cert-manager in:#cert-manager-dev "443: i/o timeout"</code>. The error message was reported in 2 GitHub issues (<a href=https://github.com/cert-manager/cert-manager/issues/2811 title="i/o timeout from apiserver when connecting to webhook on k3s">#2811</a>, <a href=https://github.com/cert-manager/cert-manager/issues/4073 title="Internal error occurred: failed calling webhook">#4073</a>)</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>Error from server (InternalError): error when creating &quot;STDIN&quot;: Internal error occurred:
<a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>  failed calling webhook &quot;webhook.cert-manager.io&quot;: failed to call webhook:
<a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>    Post &quot;https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=10s&quot;:
<a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>      dial tcp 10.0.0.69:443: i/o timeout
</code></pre></div> <p>When the API server tries to talk to the cert-manager webhook, the <code>SYN</code> packet is never answered, and the connection times out. If we were to run tcpdump inside the webhook's net namespace, we would see:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>192.168.1.43 (apiserver) -&gt; 10.0.0.69 (webhook pod) TCP 44772 → 443 [SYN]
<a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>192.168.1.43 (apiserver) -&gt; 10.0.0.69 (webhook pod) TCP [TCP Retransmission] 44772 → 443 [SYN]
<a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a>192.168.1.43 (apiserver) -&gt; 10.0.0.69 (webhook pod) TCP [TCP Retransmission] 44772 → 443 [SYN]
<a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a>192.168.1.43 (apiserver) -&gt; 10.0.0.69 (webhook pod) TCP [TCP Retransmission] 44772 → 443 [SYN]
</code></pre></div> <p>This issue is caused by the <code>SYN</code> packet being dropped somewhere.</p> <p><a id=gke-private-cluster></a></p> <h3 id=cause-1-gke-private-cluster>Cause 1: GKE Private Cluster<a class=headerlink href=#cause-1-gke-private-cluster title="Permanent link">&para;</a></h3> <p>The default Helm configuration should work with GKE private clusters, but changing <code>securePort</code> might break it.</p> <p>For context, unlike public GKE clusters where the control plane can freely talk to pods over any TCP port, the control plane in private GKE clusters can only talk to the pods in worker nodes over TCP port <code>10250</code> and <code>443</code>. These two open ports refer to the <code>containerPort</code> inside the pod, not the port called <code>port</code> in the Service resource.</p> <p>For it to work, the <code>containerPort</code> inside the Deployment must match either <code>10250</code> or <code>443</code>; <code>containerPort</code> is configured by the Helm value <code>webhook.securePort</code>. By default, <code>webhook.securePort</code> is set to <code>10250</code>.</p> <p>To see if something is off with the <code>containerPort</code>, let us start looking at the Service resource:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>kubectl get svc -n cert-manager cert-manager-webhook -oyaml
</code></pre></div> <p>Looking at the output, we see that the <code>targetPort</code> is set to <code>"https"</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Service</span><span class=w></span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager-webhook</span><span class=w></span>
<a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https</span><span class=w></span>
<a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">443</span><span class=w>           </span><span class=c1># ❌ This port is not the cause.</span><span class=w></span>
<a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class=w></span>
<a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https&quot;</span><span class=w> </span><span class=c1># 🌟 This port might be the cause.</span><span class=w></span>
</code></pre></div> <p>The reason the above <code>port: 443</code> can't be the cause is because kube-proxy, which also runs on the control plane node, translates the webhook's cluster IP to a pod IP, and also translates the above <code>port: 443</code> to the value in <code>containerPort</code>.</p> <p>To see how what is behind the target port <code>"https"</code>, we look at the Deployment resource:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>kubectl get deploy -n cert-manager cert-manager-webhook -oyaml <span class=p>|</span> grep -A3 ports:
</code></pre></div> <p>The output shows that the <code>containerPort</code> is not set to <code>10250</code>, meaning that a new firewall rule will have to be added in Google Cloud.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">12345</span><span class=w> </span><span class=c1># 🌟 This port matches neither 10250 nor 443.</span><span class=w></span>
<a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https</span><span class=w></span>
<a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=w>          </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class=w></span>
</code></pre></div> <p>To recap, if the above <code>containerPort</code> is something other than <code>443</code> or <code>10250</code> and you prefer not changing <code>containerPort</code> to <code>10250</code>, you will have to add a new firewall rule. You can read the section <a href=https://cloud.google.com/kubernetes-engine/docs/how-to/private-clusters#add_firewall_rules>Adding a firewall rule in a GKE private cluster</a> in the Google documentation.</p> <p>For context, the reason we did not default <code>securePort</code> to <code>443</code> is because binding to <code>443</code> requires one additional Linux capability (<code>NET_BIND_SERVICE</code>); on the other side, <code>10250</code> doesn't require any additional capability.</p> <h3 id=cause-2-eks-on-a-custom-cni>Cause 2: EKS on a custom CNI<a class=headerlink href=#cause-2-eks-on-a-custom-cni title="Permanent link">&para;</a></h3> <p>If you are on EKS and you are using a custom CNI such as Weave or Calico, the Kubernetes API server (which is in its own node) might not be able to reach the webhook pod. This happens because the control plane cannot be configured to run on a custom CNI on EKS, meaning that the CNIs cannot enable connectivity between the API server and the pods running in the worker nodes.</p> <p>Supposing that you are using Helm, the workaround is to add the following value in your <code>values.yaml</code> file:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=nt>webhook</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=w>  </span><span class=nt>hostNetwork</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class=w></span>
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=w>  </span><span class=nt>securePort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10260</span><span class=w></span>
</code></pre></div> <p>Or if you are using Helm from the command-line, use the following flag:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>--set webhook.hostNetwork<span class=o>=</span><span class=nb>true</span> --set webhook.securePort<span class=o>=</span><span class=m>10260</span>
</code></pre></div> <p>By setting <code>hostNetwork</code> to <code>true</code>, the webhook pod will be run in the host's network namespace. By running in the host's network namespace, the webhook pod becomes accessible over the node's IP, which means you will work around the fact that kube-apiserver can't reach any pod IPs nor cluster IPs.</p> <p>By setting <code>securePort</code> to <code>10260</code> instead of relying on the default value (which is <code>10250</code>), you will prevent a conflict between the webhook and the kubelet. The kubelet, which is an agent that runs on every Kubernetes worker node and runs directly on the host, uses the port <code>10250</code> to expose its internal API to kube-apiserver.</p> <p>To understand how <code>hostnetwork</code> and <code>securePort</code> interact, we have to look at how the TCP connection is established. When the kube-apiserver process tries to connect to the webhook pod, kube-proxy (which also runs on control plane nodes, even without a CNI) kicks in and translates the webhook's cluster IP to the webhook's host IP:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>   https://cert-manager-webhook.cert-manager.svc:443/validate
<a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a>            |
<a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>            |Step 1: resolve to the cluster IP
<a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>            v
<a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a>   https://10.43.103.211:443/validate
<a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>            |
<a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>            |Step 2: send TCP packet
<a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>            v
<a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>   src: 172.28.0.1:43021
<a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>   dst: 10.43.103.211:443
<a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>            |
<a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>            |Step 3: kube-proxy rewrite  (cluster IP to host IP)
<a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a>            v
<a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a>   src: 172.28.0.1:43021
<a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a>   dst: 172.28.0.2:10260
<a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a>            |
<a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a>            |                              control-plane node
<a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a>            |                           (host IP: 172.28.0.1)
<a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a>------------|--------------------------------------------------
<a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a>            |                           (host IP: 172.28.0.2)
<a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a>            v                                     worker node
<a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a>   +-------------------+
<a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a>   | webhook pod       |
<a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a>   | listens on        |
<a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a>   | 172.28.0.2:10260  |
<a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a>   +-------------------+
</code></pre></div> <p>The reason <code>10250</code> is used as the default <code>securePort</code> is because it works around another limitation with GKE Private Clusters, as detailed in the above section <a href=#gke-private-cluster>GKE Private Cluster</a>.</p> <h3 id=cause-3-network-policies-calico>Cause 3: Network Policies, Calico<a class=headerlink href=#cause-3-network-policies-calico title="Permanent link">&para;</a></h3> <p>Assuming that you are using the Helm chart and that you are using the default value of <code>webhook.securePort</code> (which is <code>10250</code>), and that you are using a network policy controller such as Calico, check that there exists a policy allowing traffic from the API server to the webhook pod over TCP port <code>10250</code>.</p> <h3 id=cause-4-eks-and-security-groups>Cause 4: EKS and Security Groups<a class=headerlink href=#cause-4-eks-and-security-groups title="Permanent link">&para;</a></h3> <p>Assuming that you are using the Helm chart and that you are using the default value of <code>webhook.securePort</code> (which is <code>10250</code>), you might want to check that your AWS Security Groups allow TCP traffic over <code>10250</code> from the control plane's VPC to the workers VPC.</p> <h3 id=other-causes>Other causes<a class=headerlink href=#other-causes title="Permanent link">&para;</a></h3> <p>If none of the above causes apply, you will need to figure out why the webhook is unreachable.</p> <p>To debug reachability issues (i.e., packets being dropped), we advise to use <code>tcpdump</code> along with Wireshark at every TCP hop. You can follow the article <a href=https://maelvls.dev/debugging-kubernetes-networking/ >Debugging Kubernetes Networking: my <code>kube-dns</code> is not working!</a> to learn how to use <code>tcpdump</code> with Wireshark to debug networking issues.</p> <h2 id=error-x509-certificate-is-valid-for-xxxinternal-not-cert-manager-webhookcert-managersvc-eks-with-fargate-pods>Error: <code>x509: certificate is valid for xxx.internal, not cert-manager-webhook.cert-manager.svc</code> (EKS with Fargate pods)<a class=headerlink href=#error-x509-certificate-is-valid-for-xxxinternal-not-cert-manager-webhookcert-managersvc-eks-with-fargate-pods title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>Internal error occurred: failed calling webhook &quot;webhook.cert-manager.io&quot;:
<a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>  Post https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=30s:
<a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>    x509: certificate is valid for ip-192-168-xxx-xxx.xxx.compute.internal,
<a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>    not cert-manager-webhook.cert-manager.svc
</code></pre></div> <blockquote> <p>This issue was first reported in <a href=https://github.com/cert-manager/cert-manager/issues/3237 title="Can't create an issuer when cert-manager runs on EKS in Fargate pods (AWS)">#3237</a>.</p> </blockquote> <p>This is probably because you are running on EKS with Fargate enabled. Fargate creates a microVM per pod, and the VM's kernel is used to run the container in its own namespace. The problem is that each microVM gets its own kubelet. As for any Kubernetes node, the VM's port <code>10250</code> is listened to by a kubelet process. And <code>10250</code> is also the port that the cert-manager webhook listens on.</p> <p>But that's not a problem: the kubelet process and the cert-manager webhook process are running in two separate network namespaces, and ports don't clash. That's the case both in traditional Kubernetes nodes, as well as inside a Fargate microVM.</p> <p>The problem arises when the API server tries hitting the Fargate pod: the microVM's host net namespace is configured to port-forward every possible port for maximum compatibility with traditional pods, as demonstrated in the Stack Overflow page <a href=https://stackoverflow.com/questions/66445207 title="EKS Fargate connect to local kubelet">EKS Fargate connect to local kubelet</a>. But the port <code>10250</code> is already used by the microVM's kubelet, so anything hitting this port won't be port-forwarded and will hit the kubelet instead.</p> <p>To sum up, the cert-manager webhook looks healthy and is able to listen to port <code>10250</code> as per its logs, but the microVM's host does not port-forward <code>10250</code> to the webhook's net namespace. That's the reason you see a message about an unexpected domain showing up when doing the TLS handshake: although the cert-manager webhook is properly running, the kubelet is the one responding to the API server.</p> <p>This is a limitation of Fargate's microVMs: the IP of the pod and the IP of the node are the same. It gives you the same experience as traditional pods, but it poses networking challenges.</p> <p>To fix the issue, the trick is to change the port the cert-manager webhook is listening on. Using Helm, we can use the parameter <code>webhook.securePort</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a>helm install <span class=se>\</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>  cert-manager jetstack/cert-manager <span class=se>\</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>  --namespace cert-manager <span class=se>\</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>  --create-namespace <span class=se>\</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a>  --version v1.8.0 <span class=se>\</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a>  --set webhook.securePort<span class=o>=</span><span class=m>10260</span>
</code></pre></div> <h2 id=error-service-cert-managercert-manager-webhook-not-found>Error: <code>service "cert-managercert-manager-webhook" not found</code><a class=headerlink href=#error-service-cert-managercert-manager-webhook-not-found title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a>Error from server (InternalError): error when creating &quot;test-resources.yaml&quot;: Internal error occurred:
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a>  failed calling webhook &quot;webhook.cert-manager.io&quot;: failed to call webhook:
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>    Post &quot;https://cert-managercert-manager-webhook.cert-manager.svc:443/mutate?timeout=10s&quot;:
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>      service &quot;cert-managercert-manager-webhook&quot; not found
</code></pre></div> <blockquote> <p>This error was reported in 2 GitHub issues (<a href=https://github.com/jetstack/cert-manager/issues/3195 title="service cert-manager-webhook not found">#3195</a>, <a href=https://github.com/cert-manager/cert-manager/issues/4999 title="Verification on 1.7.2 fails (Kubectl apply), service cert-manager-webhook not found">#4999</a>).</p> </blockquote> <p>We do not know the cause of this error, please comment on one of the GitHub issues above if you happen to come across it.</p> <h2 id=error-no-endpoints-available-for-service-cert-manager-webhook-ovhcloud>Error: <code>no endpoints available for service "cert-manager-webhook"</code> (OVHCloud)<a class=headerlink href=#error-no-endpoints-available-for-service-cert-manager-webhook-ovhcloud title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>Error: INSTALLATION FAILED: Internal error occurred:
<a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>  failed calling webhook &quot;webhook.cert-manager.io&quot;:
<a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>    Post https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=30s:
<a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>      no endpoints available for service &quot;cert-manager-webhook&quot;
</code></pre></div> <blockquote> <p>This issue was first reported once in Slack (<a href="https://kubernetes.slack.com/archives/C4NV3DWUC/p1634118489064400?thread_ts=1592676867.472700&cid=C4NV3DWUC">1</a>).</p> </blockquote> <p>This error is rare and was only seen in OVHcloud managed Kubernetes clusters, where the etcd resource quota is quite low. etcd is the database where your Kubernetes resources (such as pods and deployments) are stored. OVHCloud limits the disk space used by your resources in etcd. When the limit is reached, the whole cluster starts behaving erratically and one symptom is that Endpoint resources aren't created by the kubelet.</p> <p>To verify that it is in fact a problem of quota, you should be able to see the following messages in your kube-apiserver logs:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a>rpc error: <span class=nv>code</span> <span class=o>=</span> Unknown <span class=nv>desc</span> <span class=o>=</span> ETCD storage quota exceeded
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>rpc error: <span class=nv>code</span> <span class=o>=</span> Unknown <span class=nv>desc</span> <span class=o>=</span> quota computation: etcdserver: not capable
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a>rpc error: <span class=nv>code</span> <span class=o>=</span> Unknown <span class=nv>desc</span> <span class=o>=</span> The OVHcloud storage quota has been reached
</code></pre></div> <p>The workaround is to remove some resources such as CertificateRequest resources to get under the limit, as explained in OVHCloud's <a href=https://docs.ovh.com/gb/en/kubernetes/etcd-quota-error/ >ETCD Quotas error, troubleshooting</a> page.</p> <h2 id=error-x509-certificate-has-expired-or-is-not-yet-valid>Error: <code>x509: certificate has expired or is not yet valid</code><a class=headerlink href=#error-x509-certificate-has-expired-or-is-not-yet-valid title="Permanent link">&para;</a></h2> <blockquote> <p>This error message was reported once in Slack (<a href=https://kubernetes.slack.com/archives/C4NV3DWUC/p1618579222346800>1</a>).</p> </blockquote> <p>When using <code>kubectl apply</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>Internal error occurred: failed calling webhook &quot;webhook.cert-manager.io&quot;:
<a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>  Post https://kubernetes.default.svc:443/apis/webhook.cert-manager.io/v1beta1/mutations?timeout=30s:
<a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>    x509: certificate has expired or is not yet valid
</code></pre></div> <blockquote> <p>This error message was reported once in Slack (<a href=https://kubernetes.slack.com/archives/C4NV3DWUC/p1618579222346800>1</a>).</p> </blockquote> <p>Please answer to the above Slack message since we are still unsure as to what may cause this issue; to get access to the Kubernetes Slack, visit <a href=https://slack.k8s.io/ >https://slack.k8s.io/</a>.</p> <h2 id=error-nethttp-request-canceled-while-waiting-for-connection>Error: <code>net/http: request canceled while waiting for connection</code><a class=headerlink href=#error-nethttp-request-canceled-while-waiting-for-connection title="Permanent link">&para;</a></h2> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>Error from server (InternalError): error when creating &quot;STDIN&quot;:
<a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>  Internal error occurred: failed calling webhook &quot;webhook.cert-manager.io&quot;:
<a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a>    Post https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=30s:
<a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a>      net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)
</code></pre></div> <blockquote> <p>This error message was reported once in Slack (<a href=https://kubernetes.slack.com/archives/C4NV3DWUC/p1632849763397100>1</a>).</p> </blockquote> <p><a id=context-deadline-exceeded></a></p> <h2 id=error-context-deadline-exceeded>Error: <code>context deadline exceeded</code><a class=headerlink href=#error-context-deadline-exceeded title="Permanent link">&para;</a></h2> <blockquote> <p>This error message was reported in GitHub issues (<a href=https://github.com/cert-manager/cert-manager/issues/2319 title="Documenting context deadline exceeded errors relating to the webhook, on bare metal">2319</a>, <a href=https://github.com/cert-manager/cert-manager/issues/2706 title>2706</a> <a href=https://github.com/cert-manager/cert-manager/issues/5189 title="Post https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=10s: context deadline exceeded">5189</a>, <a href=https://github.com/cert-manager/cert-manager/issues/5004 title="After installing cert-manager using kubectl, cmctl check api fails with https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=10s: context deadline exceeded">5004</a>), and once <a href=https://stackoverflow.com/questions/72059332/how-can-i-fix-failed-calling-webhook-webhook-cert-manager-io>on Stack Overflow</a>.</p> </blockquote> <p>This error appears with cert-manager 0.12 and above when trying to apply an Issuer or any other cert-manager custom resource after having installed or upgraded cert-manager:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a>Error from server (InternalError): error when creating &quot;STDIN&quot;:
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>  Internal error occurred: failed calling webhook &quot;webhook.cert-manager.io&quot;:
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>    Post https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=30s:
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a>      context deadline exceeded
</code></pre></div> <blockquote> <p>ℹ️ In older releases of cert-manager (0.11 and below), the webhook relied on the <a href=https://kubernetes.io/docs/tasks/extend-kubernetes/setup-extension-api-server/ >APIService mechanism</a>, and the message looked a bit different but the cause was the same:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a>Error from server (InternalError): error when creating &quot;STDIN&quot;:
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>  Internal error occurred: failed calling webhook &quot;webhook.certmanager.k8s.io&quot;:
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>    Post https://kubernetes.default.svc:443/apis/webhook.certmanager.k8s.io/v1beta1/mutations?timeout=30s:
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a>      context deadline exceeded
</code></pre></div> <p>ℹ️ The message <code>context deadline exceeded</code> also appears when using <code>cmctl check api</code>. The cause is identical, you can continue reading this section to debug it.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>Not ready: Internal error occurred: failed calling webhook &quot;webhook.cert-manager.io&quot;: failed to call webhook:
<a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>  Post &quot;https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=10s&quot;:
<a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>    context deadline exceeded
</code></pre></div> </blockquote> <p>The trouble with the message <code>context deadline exceeded</code> is that it obfuscates the part of the HTTP connection that timed out. When this message appears, we can't tell which part of the HTTP interaction timed out. It might be the DNS resolution, the TCP handshake, the TLS handshake, sending the HTTP request or receiving the HTTP response.</p> <blockquote> <p>ℹ️ For context, the query parameter <code>?timeout=30s</code> that you can see in the above error messages is a timeout that the API server decides when calling the webhook. It is often set to 10 or 30 seconds.</p> </blockquote> <p>The following diagram shows what are the three errors that may be hidden behind the all-catching "context deadline exceeded" error message, represented by the outer box, that is usually thrown after 30 seconds:</p> <p><a id=diagram></a></p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>                                                   context deadline exceeded
<a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a>                                                                           |
<a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a>                                  30 seconds                               |
<a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a>                                   timeout                                 v
<a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a> +-------------------------------------------------------------------------+
<a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a> |                                                                         |
<a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a> |       i/o timeout                                                       |
<a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a> |            |        net/http: TLS handshake timeout                     |
<a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a> | 10 seconds |                     |                                      |
<a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a> |  timeout   v                     |                                      |
<a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a> |------------+      30 seconds     |           net/http: request canceled |
<a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a> |TCP         |       timeout       v           while awaiting headers     |
<a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a> |handshake   +---------------------+                         |            |
<a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a> |------------|      TLS            |                         |            |
<a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a> |            |      handshake      +------------+ 10 seconds |            |
<a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a> |            +---------------------|  sending   |  timeout   v            |
<a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a> |                                  |  request   +------------+            |
<a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a> |                                  +------------|receiving   |------+     |
<a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a> |                                               |resp. header| recv.|     |
<a id=__codelineno-35-20 name=__codelineno-35-20 href=#__codelineno-35-20></a> |                                               +------------+ resp.|     |
<a id=__codelineno-35-21 name=__codelineno-35-21 href=#__codelineno-35-21></a> |                                                            | body +-----+
<a id=__codelineno-35-22 name=__codelineno-35-22 href=#__codelineno-35-22></a> |                                                            +------|other|
<a id=__codelineno-35-23 name=__codelineno-35-23 href=#__codelineno-35-23></a> |                                                                   |logic|
<a id=__codelineno-35-24 name=__codelineno-35-24 href=#__codelineno-35-24></a> |                                                                   +-----+
<a id=__codelineno-35-25 name=__codelineno-35-25 href=#__codelineno-35-25></a> +-------------------------------------------------------------------------+
<a id=__codelineno-35-26 name=__codelineno-35-26 href=#__codelineno-35-26></a> &lt;----------&gt; &lt;----------------------------------------------&gt;
<a id=__codelineno-35-27 name=__codelineno-35-27 href=#__codelineno-35-27></a> connectivity                   webhook-side
<a id=__codelineno-35-28 name=__codelineno-35-28 href=#__codelineno-35-28></a> issue                          issue
</code></pre></div> <p>In the rest of the section, we will be trying to trigger one of the three "more specific" errors:</p> <ul> <li><code>i/o timeout</code> is the TCP handshake timeout and comes from <a href=https://pkg.go.dev/net#DialTimeout><code>DialTimeout</code></a> in the Kubernetes apiserver. The name resolution may be the cause, but usually, this message appears after the API server sent the <code>SYN</code> packet and waited for 10 seconds for the <code>SYN-ACK</code> packet to be received from the cert-manager webhook.</li> <li><code>net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)</code> is the HTTP response timeout and comes from <a href=https://github.com/kubernetes/kubernetes/blob/abba1492f/staging/src/k8s.io/apiserver/pkg/util/webhook/webhook.go#L96-L101>here</a> and is configured to <a href=https://github.com/kubernetes/kubernetes/blob/abba1492f/staging/src/k8s.io/apiserver/pkg/util/webhook/webhook.go#L36-L38>30 seconds</a>. The Kubernetes API server already sent the HTTP request is is waiting for the HTTP response headers (e.g., <code>HTTP/1.1 200 OK</code>).</li> <li><code>net/http: TLS handshake timeout</code> is when the TCP handshake is done, and the Kubernetes API server sent the initial TLS handshake packet (<code>ClientHello</code>) and waited for 10 seconds for the cert-manager webhook to answer with the <code>ServerHello</code> packet.</li> </ul> <p>We can sort these three messages in two categories: either it is a connectivity issue (<code>SYN</code> is dropped), or it is a webhook issue (i.e., the TLS certificate is wrong, or the webhook is not returning any HTTP response):</p> <table> <thead> <tr> <th>Timeout message</th> <th>Category</th> </tr> </thead> <tbody> <tr> <td><code>i/o timeout</code></td> <td>connectivity issue</td> </tr> <tr> <td><code>net/http: TLS handshake timeout</code></td> <td>webhook-side issue</td> </tr> <tr> <td><code>net/http: request canceled while awaiting headers</code></td> <td>webhook-side issue</td> </tr> </tbody> </table> <p>The first step is to rule out a webhook-side issue. In your shell session, run the following:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>kubectl -n cert-manager port-forward deploy/cert-manager-webhook <span class=m>10250</span>
</code></pre></div> <p>In another shell session, check that you can reach the webhook:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a>curl -vsS --resolve cert-manager-webhook.cert-manager.svc:10250:127.0.0.1 <span class=se>\</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>    --service-name cert-manager-webhook-ca <span class=se>\</span>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>    --cacert &lt;<span class=o>(</span>kubectl -n cert-manager get secret cert-manager-webhook-ca -ojsonpath<span class=o>=</span><span class=s1>&#39;{.data.ca\.crt}&#39;</span> <span class=p>|</span> base64 -d<span class=o>)</span> <span class=se>\</span>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a>    https://cert-manager-webhook.cert-manager.svc:10250/validate <span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span> -d@- <span class=s>&lt;&lt;&#39;EOF&#39; | sed &#39;/^* /d; /bytes data]$/d; s/&gt; //; s/&lt; //&#39;</span>
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=s>{&quot;kind&quot;:&quot;AdmissionReview&quot;,&quot;apiVersion&quot;:&quot;admission.k8s.io/v1&quot;,&quot;request&quot;:{&quot;requestKind&quot;:{&quot;group&quot;:&quot;cert-manager.io&quot;,&quot;version&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Certificate&quot;},&quot;requestResource&quot;:{&quot;group&quot;:&quot;cert-manager.io&quot;,&quot;version&quot;:&quot;v1&quot;,&quot;resource&quot;:&quot;certificates&quot;},&quot;name&quot;:&quot;foo&quot;,&quot;namespace&quot;:&quot;default&quot;,&quot;operation&quot;:&quot;CREATE&quot;,&quot;object&quot;:{&quot;apiVersion&quot;:&quot;cert-manager.io/v1&quot;,&quot;kind&quot;:&quot;Certificate&quot;,&quot;spec&quot;:{&quot;dnsNames&quot;:[&quot;foo&quot;],&quot;issuerRef&quot;:{&quot;group&quot;:&quot;cert-manager.io&quot;,&quot;kind&quot;:&quot;Issuer&quot;,&quot;name&quot;:&quot;letsencrypt&quot;},&quot;secretName&quot;:&quot;foo&quot;,&quot;usages&quot;:[&quot;digital signature&quot;]}}}}</span>
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=s>EOF</span>
</code></pre></div> <p>The happy output looks like this:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=nf>POST</span> <span class=nn>/validate</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=na>Host</span><span class=o>:</span> <span class=l>cert-manager-webhook.cert-manager.svc:10250</span>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=na>User-Agent</span><span class=o>:</span> <span class=l>curl/7.83.0</span>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=na>Accept</span><span class=o>:</span> <span class=l>*/*</span>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=na>Content-Length</span><span class=o>:</span> <span class=l>1299</span>
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=na>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a>
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a>HTTP/1.1 200 OK
<a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a>Date: Wed, 08 Jun 2022 14:52:21 GMT
<a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a>Content-Length: 2029
<a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a>Content-Type: text/plain; charset=utf-8
<a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a>
<a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a>...
<a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a>&quot;response&quot;: {
<a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a>  &quot;uid&quot;: &quot;&quot;,
<a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a>  &quot;allowed&quot;: true
<a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a>}
</code></pre></div> <p>If the response shows <code>200 OK</code>, we can rule out a webhook-side issue. Since the initial error message was <code>context deadline exceeded</code> and not an apiserver-side issue such as <code>x509: certificate signed by unknown authority</code> or <code>x509: certificate has expired or is not yet valid</code>, we can conclude that the problem is a connectivity issue: the Kubernetes API server isn't able to establish a TCP connection to the cert-manager webhook. Please follow the instructions in the section <a href=#io-timeout>Error: <code>i/o timeout</code> (connectivity issue)</a> above to continue debugging.</p> <h2 id=error-nethttp-tls-handshake-timeout>Error: <code>net/http: TLS handshake timeout</code><a class=headerlink href=#error-nethttp-tls-handshake-timeout title="Permanent link">&para;</a></h2> <blockquote> <p>This error message was reported in 1 GitHub issue (<a href=https://github.com/cert-manager/cert-manager/issues/2602 title="Internal error occurred: failed calling webhook webhook.cert-manager.io: Post https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=30s: net/http: TLS handshake timeout">#2602</a>).</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a>Error from server (InternalError): error when creating &quot;STDIN&quot;:
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>  Internal error occurred: failed calling webhook &quot;webhook.cert-manager.io&quot;:
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>    Post https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=30s:
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a>      net/http: TLS handshake timeout
</code></pre></div> <p>Looking at the <a href=#diagram>above diagram</a>, this error message indicates that the Kubernetes API server successfully established a TCP connection to the pod IP associated with the cert-manager webhook. The TLS handshake timeout means that the cert-manager webhook process isn't the one ending the TCP connection: there is some HTTP proxy in between that is probably waiting for a plain HTTP request instead a <code>ClientHello</code> packet.</p> <p>We do not know the cause of this error. Please comment on the above GitHub issue if you notice this error.</p> <h2 id=error-http-probe-failed-with-statuscode-500>Error: <code>HTTP probe failed with statuscode: 500</code><a class=headerlink href=#error-http-probe-failed-with-statuscode-500 title="Permanent link">&para;</a></h2> <blockquote> <p>This error message was reported in 2 GitHub issue (<a href=https://github.com/cert-manager/cert-manager/issues/3185 title="kubectl install cert-manager: Readiness probe failed: HTTP probe failed with statuscode: 500">#3185</a>, <a href=https://github.com/cert-manager/cert-manager/issues/4557 title="kubectl install cert-manager: Readiness probe failed: HTTP probe failed with statuscode: 500">#4557</a>).</p> </blockquote> <p>The error message is visible as an event on the cert-manager webhook:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a>Warning  Unhealthy  &lt;invalid&gt; (x13 over 15s)  kubelet, node83
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>  Readiness probe failed: HTTP probe failed with statuscode: 500
</code></pre></div> <p>We do not know the cause of this error. Please comment on the above GitHub issue if you notice this error.</p> <h2 id=error-service-unavailable>Error: <code>Service Unavailable</code><a class=headerlink href=#error-service-unavailable title="Permanent link">&para;</a></h2> <blockquote> <p>This error was reported in 1 GitHub issue (<a href=https://github.com/cert-manager/cert-manager/issues/4281 title="Can't deploy Issuer, Service Unavailable">#4281</a>)</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a>Error from server (InternalError): error when creating &quot;STDIN&quot;: Internal error occurred:
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>  failed calling webhook &quot;webhook.cert-manager.io&quot;:
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a>    Post &quot;https://my-cert-manager-webhook.default.svc:443/mutate?timeout=10s&quot;:
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a>      Service Unavailable
</code></pre></div> <p>The above message appears in Kubernetes clusters using the Weave CNI.</p> <p>We do not know the cause of this error. Please comment on the above GitHub issue if you notice this error.</p> <h2 id=error-failed-calling-admission-webhook-the-server-is-currently-unable-to-handle-the-request>Error: <code>failed calling admission webhook: the server is currently unable to handle the request</code><a class=headerlink href=#error-failed-calling-admission-webhook-the-server-is-currently-unable-to-handle-the-request title="Permanent link">&para;</a></h2> <blockquote> <p>This issue was reported in 4 GitHub issues (<a href=https://github.com/cert-manager/cert-manager/issues/1369 title="the server is currently unable to handle the request">1369</a>, <a href=https://github.com/cert-manager/cert-manager/issues/1425 title="Verifying Install: failed calling admission webhook (Azure, GKE private cluster)">1425</a> <a href=https://github.com/cert-manager/cert-manager/issues/3542 title="SSL Certificate Manager has got expired, we need to renew SSL certificate in existing ClusterIssuer Kubernetes Service (AKS)">3542</a>, <a href=https://github.com/cert-manager/cert-manager/issues/4852 title="error: unable to retrieve the complete list of server APIs: webhook.cert-manager.io/v1beta1: the server is currently unable to handle the request (AKS)">4852</a>)</p> </blockquote> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a>Error from server (InternalError): error when creating &quot;test-resources.yaml&quot;: Internal error occurred:
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>  failed calling admission webhook &quot;issuers.admission.certmanager.k8s.io&quot;:
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>    the server is currently unable to handle the request
</code></pre></div> <p>We do not know the cause of this error. Please comment in one of the above GitHub issues if you are able to reproduce this error.</p> <h2 id=error-x509-certificate-signed-by-unknown-authority>Error: <code>x509: certificate signed by unknown authority</code><a class=headerlink href=#error-x509-certificate-signed-by-unknown-authority title="Permanent link">&para;</a></h2> <blockquote> <p>Reported in GitHub issues (<a href=https://github.com/cert-manager/cert-manager/issues/2602#issuecomment-606474055 title="x509: certificate signed by unknown authority">2602</a>)</p> </blockquote> <p>When installing or upgrading cert-manager and using a namespace that is not <code>cert-manager</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a>Error: UPGRADE FAILED: release core-l7 failed, and has been rolled back due to atomic being set:
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>  failed to create resource: conversion webhook for cert-manager.io/v1alpha3, Kind=ClusterIssuer failed:
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a>    Post https://cert-manager-webhook.core-l7.svc:443/convert?timeout=30s:
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a>      x509: certificate signed by unknown authority
</code></pre></div> <p>A very similar error message may show when creating an Issuer or any other cert-manager custom resource:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a>Internal error occurred: failed calling webhook &quot;webhook.cert-manager.io&quot;:
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>  Post https://cert-manager-webhook.cert-manager.svc:443/mutate?timeout=30s:
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a>    x509: certificate signed by unknown authority`
</code></pre></div> <p>With <code>cmctl install</code> and <code>cmctl check api</code>, you might see the following error message:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a>2022/06/06 15:36:30 Not ready: the cert-manager webhook CA bundle is not injected yet
<a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a>  (Internal error occurred: conversion webhook for cert-manager.io/v1alpha2, Kind=Certificate failed:
<a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a>    Post &quot;https://&lt;company_name&gt;-cert-manager-webhook.cert-manager.svc:443/convert?timeout=30s&quot;:
<a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>      x509: certificate signed by unknown authority)
</code></pre></div> <p>If you are using cert-manager 0.14 and below with Helm, and that you are installing in a namespace different from <code>cert-manager</code>, the CRD manifest had the namespace name <code>cert-manager</code> hardcoded. You can see the hardcoded namespace in the following annotation:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a>kubectl get crd issuers.cert-manager.io -oyaml <span class=p>|</span> grep inject
</code></pre></div> <p>You will see the following:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=nt>cert-manager.io/inject-ca-from-secret</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager/cert-manager-webhook-ca</span><span class=w></span>
<a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=c1>#                                      ^^^^^^^^^^^^</span><span class=w></span>
<a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=c1>#                                       hardcoded</span><span class=w></span>
</code></pre></div> <blockquote> <p><strong>Note 1:</strong> this bug in the cert-manager Helm chart was <a href=https://github.com/cert-manager/cert-manager/commit/f33beefc>was fixed</a> in cert-manager 0.15.</p> <p><strong>Note 2:</strong> since cert-manager 1.6, this annotation is <a href=https://github.com/cert-manager/cert-manager/pull/4841>no longer used</a> on the cert-manager CRDs since conversion is no longer needed.</p> </blockquote> <p>The solution, if you are still using cert-manager 0.14 or below, is to render the manifest using <code>helm template</code>, then edit the annotation to use the correct namespace, and then use <code>kubectl apply</code> to install cert-manager.</p> <p>If you are using cert-manager 1.6 and below, the issue might be due to the cainjector being stuck trying to inject the self-signed certificate that the cert-manager webhook created and stored in the Secret resource <code>cert-manager-webhook-ca</code> into the <code>spec.caBundle</code> field of the cert-manager CRDs. The first step is to check whether the cainjector is running with no problem:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=gp>$ </span>kubectl -n cert-manager get pods -l app.kubernetes.io/name<span class=o>=</span>cainjector
<a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=go>NAME                                       READY   STATUS    RESTARTS       AGE</span>
<a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=go>cert-manager-cainjector-5c55bb7cb4-6z4cf   1/1     Running   11 (31h ago)   28d</span>
</code></pre></div> <p>Looking at the logs, you will be able to tell if the leader election worked. It can take up to one minute for the leader election work to complete.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=go>I0608 start.go:126] &quot;starting&quot; version=&quot;v1.8.0&quot; revision=&quot;e466a521bc5455def8c224599c6edcd37e86410c&quot;</span>
<a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=go>I0608 leaderelection.go:248] attempting to acquire leader lease kube-system/cert-manager-cainjector-leader-election...</span>
<a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=go>I0608 leaderelection.go:258] successfully acquired lease kube-system/cert-manager-cainjector-leader-election</span>
<a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=go>I0608 controller.go:186] cert-manager/secret/customresourcedefinition/controller/controller-for-secret-customresourcedefinition &quot;msg&quot;=&quot;Starting Controller&quot;</span>
<a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=go>I0608 controller.go:186] cert-manager/certificate/customresourcedefinition/controller/controller-for-certificate-customresourcedefinition &quot;msg&quot;=&quot;Starting Controller&quot;</span>
<a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=go>I0608 controller.go:220] cert-manager/secret/customresourcedefinition/controller/controller-for-secret-customresourcedefinition &quot;msg&quot;=&quot;Starting workers&quot;  &quot;worker count&quot;=1</span>
<a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=go>I0608 controller.go:220] cert-manager/certificate/customresourcedefinition/controller/controller-for-certificate-customresourcedefinition &quot;msg&quot;=&quot;Starting workers&quot;  &quot;worker count&quot;=1</span>
</code></pre></div> <p>The happy output contains lines like this:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=go>I0608 sources.go:184] cert-manager/secret/customresourcedefinition/generic-inject-reconciler</span>
<a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=go>  &quot;msg&quot;=&quot;Extracting CA from Secret resource&quot; &quot;resource_name&quot;=&quot;issuers.cert-manager.io&quot; &quot;secret&quot;=&quot;cert-manager/cert-manager-webhook-ca&quot;</span>
<a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=go>I0608 controller.go:178] cert-manager/secret/customresourcedefinition/generic-inject-reconciler</span>
<a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=go>  &quot;msg&quot;=&quot;updated object&quot; &quot;resource_name&quot;=&quot;issuers.cert-manager.io&quot;</span>
</code></pre></div> <p>Now, look for any message that indicates that the Secret resource that the cert-manager webhook created can't be loaded. The two error messages that might show up are:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a>E0608 sources.go:201] cert-manager/secret/customresourcedefinition/generic-inject-reconciler
<a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a>  &quot;msg&quot;=&quot;unable to fetch associated secret&quot; &quot;error&quot;=&quot;Secret \&quot;cert-manager-webhook-caq\&quot; not found&quot;
</code></pre></div> <p>The following message indicates that the given CRD has been skipped because the annotation is missing. You can ignore these messages:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a>I0608 controller.go:156] cert-manager/secret/customresourcedefinition/generic-inject-reconciler
<a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a>  &quot;msg&quot;=&quot;failed to determine ca data source for injectable&quot; &quot;resource_name&quot;=&quot;challenges.acme.cert-manager.io&quot;
</code></pre></div> <p>If nothing seems wrong with the cainjector logs, you will want to check that the <code>spec.caBundle</code> field in the validation, mutation, and conversion configurations are correct. The Kubernetes API server uses the contents of that field to trust the cert-manager webhook. The <code>caBundle</code> contains the self-signed CA created by the cert-manager webhook when it started.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=gp>$ </span>kubectl get validatingwebhookconfigurations cert-manager-webhook -ojson <span class=p>|</span> jq <span class=s1>&#39;.webhooks[].clientConfig&#39;</span>
<a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=go>{</span>
<a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=go>  &quot;caBundle&quot;: &quot;LS0tLS1...LS0tLS0K&quot;,</span>
<a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=go>  &quot;service&quot;: {</span>
<a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=go>    &quot;name&quot;: &quot;cert-manager-webhook&quot;,</span>
<a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=go>    &quot;namespace&quot;: &quot;cert-manager&quot;,</span>
<a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=go>    &quot;path&quot;: &quot;/validate&quot;,</span>
<a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=go>    &quot;port&quot;: 443</span>
<a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=go>  }</span>
<a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=go>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=gp>$ </span>kubectl get mutatingwebhookconfigurations cert-manager-webhook -ojson <span class=p>|</span> jq <span class=s1>&#39;.webhooks[].clientConfig&#39;</span>
<a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=go>{</span>
<a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=go>  &quot;caBundle&quot;: &quot;LS0tLS1...RFLS0tLS0K&quot;,</span>
<a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=go>  &quot;service&quot;: {</span>
<a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=go>    &quot;name&quot;: &quot;cert-manager-webhook&quot;,</span>
<a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=go>    &quot;namespace&quot;: &quot;cert-manager&quot;,</span>
<a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=go>    &quot;path&quot;: &quot;/validate&quot;,</span>
<a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a><span class=go>    &quot;port&quot;: 443</span>
<a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a><span class=go>  }</span>
<a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a><span class=go>}</span>
</code></pre></div> <p>Let us see the contents of the <code>caBundle</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=gp>$ </span>kubectl get mutatingwebhookconfigurations cert-manager-webhook -ojson <span class=se>\</span>
<a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a>  <span class=p>|</span> jq <span class=s1>&#39;.webhooks[].clientConfig.caBundle&#39;</span> -r <span class=p>|</span> base64 -d <span class=se>\</span>
<a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a>  <span class=p>|</span> openssl x509 -noout -text -in -
<a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a>
<a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=go>Certificate:</span>
<a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=go>    Data:</span>
<a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=go>        Version: 3 (0x2)</span>
<a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=go>        Serial Number:</span>
<a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=go>            ee:8f:4f:c8:55:7b:16:76:d8:6a:a2:e5:94:bc:7c:6b</span>
<a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a><span class=go>        Signature Algorithm: ecdsa-with-SHA384</span>
<a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=go>        Issuer: CN = cert-manager-webhook-ca</span>
<a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=go>        Validity</span>
<a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=go>            Not Before: May 10 16:13:37 2022 GMT</span>
<a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a><span class=go>            Not After : May 10 16:13:37 2023 GMT</span>
<a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a><span class=go>        Subject: CN = cert-manager-webhook-ca</span>
</code></pre></div> <p>Let us check that the contents of <code>caBundle</code> works for connecting to the webhook:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=gp>$ </span>kubectl -n cert-manager get secret cert-manager-webhook-ca -ojsonpath<span class=o>=</span><span class=s1>&#39;{.data.ca\.crt}&#39;</span> <span class=se>\</span>
<a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>  <span class=p>|</span> base64 -d <span class=p>|</span> openssl x509 -noout -text -in -
<a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a>
<a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=go>Certificate:</span>
<a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=go>    Data:</span>
<a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=go>        Version: 3 (0x2)</span>
<a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=go>        Serial Number:</span>
<a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a><span class=go>            ee:8f:4f:c8:55:7b:16:76:d8:6a:a2:e5:94:bc:7c:6b</span>
<a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a><span class=go>        Signature Algorithm: ecdsa-with-SHA384</span>
<a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a><span class=go>        Issuer: CN = cert-manager-webhook-ca</span>
<a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a><span class=go>        Validity</span>
<a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a><span class=go>            Not Before: May 10 16:13:37 2022 GMT</span>
<a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a><span class=go>            Not After : May 10 16:13:37 2023 GMT</span>
<a id=__codelineno-56-14 name=__codelineno-56-14 href=#__codelineno-56-14></a><span class=go>        Subject: CN = cert-manager-webhook-ca</span>
</code></pre></div> <p>Our final test is to try to connect to the webhook using this trust bundle. Let us port-forward to the webhook pod:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a>kubectl -n cert-manager port-forward deploy/cert-manager-webhook <span class=m>10250</span>
</code></pre></div> <p>In another shell session, send a <code>/validate</code> HTTP request with the following command:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a>curl -vsS --resolve cert-manager-webhook.cert-manager.svc:10250:127.0.0.1 <span class=se>\</span>
<a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a>    --service-name cert-manager-webhook-ca <span class=se>\</span>
<a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a>    --cacert &lt;<span class=o>(</span>kubectl get validatingwebhookconfigurations cert-manager-webhook -ojson <span class=p>|</span> jq <span class=s1>&#39;.webhooks[].clientConfig.caBundle&#39;</span> -r <span class=p>|</span> base64 -d<span class=o>)</span> <span class=se>\</span>
<a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a>    https://cert-manager-webhook.cert-manager.svc:10250/validate <span class=m>2</span>&gt;<span class=p>&amp;</span><span class=m>1</span> -d@- <span class=s>&lt;&lt;&#39;EOF&#39; | sed &#39;/^* /d; /bytes data]$/d; s/&gt; //; s/&lt; //&#39;</span>
<a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=s>{&quot;kind&quot;:&quot;AdmissionReview&quot;,&quot;apiVersion&quot;:&quot;admission.k8s.io/v1&quot;,&quot;request&quot;:{&quot;requestKind&quot;:{&quot;group&quot;:&quot;cert-manager.io&quot;,&quot;version&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Certificate&quot;},&quot;requestResource&quot;:{&quot;group&quot;:&quot;cert-manager.io&quot;,&quot;version&quot;:&quot;v1&quot;,&quot;resource&quot;:&quot;certificates&quot;},&quot;name&quot;:&quot;foo&quot;,&quot;namespace&quot;:&quot;default&quot;,&quot;operation&quot;:&quot;CREATE&quot;,&quot;object&quot;:{&quot;apiVersion&quot;:&quot;cert-manager.io/v1&quot;,&quot;kind&quot;:&quot;Certificate&quot;,&quot;spec&quot;:{&quot;dnsNames&quot;:[&quot;foo&quot;],&quot;issuerRef&quot;:{&quot;group&quot;:&quot;cert-manager.io&quot;,&quot;kind&quot;:&quot;Issuer&quot;,&quot;name&quot;:&quot;letsencrypt&quot;},&quot;secretName&quot;:&quot;foo&quot;,&quot;usages&quot;:[&quot;digital signature&quot;]}}}}</span>
<a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a><span class=s>EOF</span>
</code></pre></div> <p>You should see a successful HTTP request and response:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=nf>POST</span> <span class=nn>/validate</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
<a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=na>Host</span><span class=o>:</span> <span class=l>cert-manager-webhook.cert-manager.svc:10250</span>
<a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=na>User-Agent</span><span class=o>:</span> <span class=l>curl/7.83.0</span>
<a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=na>Accept</span><span class=o>:</span> <span class=l>*/*</span>
<a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=na>Content-Length</span><span class=o>:</span> <span class=l>1299</span>
<a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=na>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
<a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a>
<a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a>HTTP/1.1 200 OK
<a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a>Date: Wed, 08 Jun 2022 16:20:45 GMT
<a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a>Content-Length: 2029
<a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a>Content-Type: text/plain; charset=utf-8
<a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a>
<a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a>...
</code></pre></div> <h2 id=error-cluster-scoped-resource-mutatingwebhookconfigurations-is-managed-and-access-is-denied>Error: <code>cluster scoped resource "mutatingwebhookconfigurations/" is managed and access is denied</code><a class=headerlink href=#error-cluster-scoped-resource-mutatingwebhookconfigurations-is-managed-and-access-is-denied title="Permanent link">&para;</a></h2> <blockquote> <p>This message was reported in GitHub issue <a href=https://github.com/cert-manager/cert-manager/issues/3717 title="Cannot install on GKE autopilot cluster due to mutatingwebhookconfigurations access denied">3717</a>.</p> </blockquote> <p>While installing cert-manager on GKE Autopilot, you will see the following message:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a>Error: rendered manifests contain a resource that already exists. Unable to continue with install:
<a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a>  could not get information about the resource:
<a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a>    mutatingwebhookconfigurations.admissionregistration.k8s.io &quot;cert-manager-webhook&quot; is forbidden:
<a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a>      User &quot;XXXX&quot; cannot get resource &quot;mutatingwebhookconfigurations&quot; in API group &quot;admissionregistration.k8s.io&quot; at the cluster scope:
<a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a>        GKEAutopilot authz: cluster scoped resource &quot;mutatingwebhookconfigurations/&quot; is managed and access is denied
</code></pre></div> <p>This error message will appear when using Kubernetes 1.20 and below with GKE Autopilot. It is due to a <a href=https://github.com/cert-manager/cert-manager/issues/3717>restriction on mutating admission webhooks in GKE Autopilot</a>.</p> <p>As of October 2021, the "rapid" Autopilot release channel has rolled out version 1.21 for Kubernetes masters. Installation via the Helm chart may end in an error message but cert-manager is reported to be working by some users. Feedback and PRs are welcome.</p> <h2 id=error-the-namespace-kube-system-is-managed-and-the-requests-verb-create-is-denied>Error: <code>the namespace "kube-system" is managed and the request's verb "create" is denied</code><a class=headerlink href=#error-the-namespace-kube-system-is-managed-and-the-requests-verb-create-is-denied title="Permanent link">&para;</a></h2> <p>When installing cert-manager on GKE Autopilot with Helm, you will see the following error message:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a>Not ready: the cert-manager webhook CA bundle is not injected yet
</code></pre></div> <p>After this failure, you should still see the three pods happily running:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=gp>$ </span>kubectl get pods -n cert-manager
<a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=go>NAME                                      READY   STATUS    RESTARTS   AGE</span>
<a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=go>cert-manager-76578c9687-24kmr             1/1     Running   0          47m</span>
<a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=go>cert-manager-cainjector-b7d47f746-4799n   1/1     Running   0          47m</span>
<a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=go>cert-manager-webhook-7f788c5b6-mspnt      1/1     Running   0          47m</span>
</code></pre></div> <p>But looking at either of the logs, you will see the following error message:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a>E0425 leaderelection.go:334] error initially creating leader election record:
<a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a>  leases.coordination.k8s.io is forbidden: User &quot;system:serviceaccount:cert-manager:cert-manager-webhook&quot;
<a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a>    cannot create resource &quot;leases&quot; in API group &quot;coordination.k8s.io&quot; in the namespace &quot;kube-system&quot;:
<a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a>      GKEAutopilot authz: the namespace &quot;kube-system&quot; is managed and the request&#39;s verb &quot;create&quot; is denied
</code></pre></div> <p>That is due to a limitation of GKE Autopilot. It is not possible to create resources in the <code>kube-system</code> namespace, and cert-manager uses the well-known <code>kube-system</code> to manage the leader election. To get around the limitation, you can tell Helm to use a different namespace for the leader election:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a>helm install cert-manager jetstack/cert-manager --version <span class=m>1</span>.8.0 <span class=se>\</span>
<a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a>  --namespace cert-manager --create-namespace <span class=se>\</span>
<a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a>  --set global.leaderElection.namespace<span class=o>=</span>cert-manager
</code></pre></div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../acme/ class="md-footer__link md-footer__link--prev" aria-label="上一页: ACME/Let's Encrypt 证书故障处理" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 上一页 </span> ACME/Let's Encrypt 证书故障处理 </div> </div> </a> <a href=../../concepts/ class="md-footer__link md-footer__link--next" aria-label="下一页: 介绍" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> 下一页 </span> 介绍 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> © 2022 The cert-manager Authors. © 2022 The Linux Foundation. All rights reserved. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/cert-manager/cert-manager target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://infosec.exchange/@CertManager target=_blank rel=noopener title=infosec.exchange class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg> </a> <a href=https://twitter.com/CertManager/ target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\s\\-\uff0c\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../assets/javascripts/bundle.5a2dcb6a.min.js></script> </body> </html>