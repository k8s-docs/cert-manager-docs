<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Learn how to deploy cert-manager on Google Kubernetes (GKE) Engine and then configure it to sign SSL certificates using Let's Encrypt"><meta name=author content="James Munnelly"><link href=https://cert-manager.io/tutorials/getting-started-with-cert-manager-on-google-kubernetes-engine-using-lets-encrypt-for-ingress-ssl/ rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-8.5.10"><title>Deploy cert-manager on Google Kubernetes Engine (GKE) and create SSL certificates for Ingress using Let's Encrypt - cert-manager</title><link rel=stylesheet href=../../assets/stylesheets/main.975780f9.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#prerequisites class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=cert-manager class="md-header__button md-logo" aria-label=cert-manager data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> cert-manager </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Deploy cert-manager on Google Kubernetes Engine (GKE) and create SSL certificates for Ingress using Let's Encrypt </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/cert-manager/cert-manager title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> cert-manager/cert-manager </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> ç®€ä»‹ </a> </li> <li class=md-tabs__item> <a href=../../getting-started/ class=md-tabs__link> å…¥é—¨ </a> </li> <li class=md-tabs__item> <a href=../../installation/ class=md-tabs__link> å®‰è£… </a> </li> <li class=md-tabs__item> <a href=../../configuration/ class=md-tabs__link> é…ç½® </a> </li> <li class=md-tabs__item> <a href=../../usage/ class=md-tabs__link> ä½¿ç”¨ </a> </li> <li class=md-tabs__item> <a href=../../projects/ class=md-tabs__link> é¡¹ç›® </a> </li> <li class=md-tabs__item> <a href=../ class=md-tabs__link> æ‰‹å†Œ </a> </li> <li class=md-tabs__item> <a href=../../troubleshooting/ class=md-tabs__link> æ•…éšœæ’é™¤ </a> </li> <li class=md-tabs__item> <a href=../../faq/ class=md-tabs__link> FAQ </a> </li> <li class=md-tabs__item> <a href=../../contributing/ class=md-tabs__link> è´¡çŒ® </a> </li> <li class=md-tabs__item> <a href=../../release-notes/ class=md-tabs__link> å‘å¸ƒè¯´æ˜ </a> </li> <li class=md-tabs__item> <a href=../../concepts/ class=md-tabs__link> æ¦‚å¿µ </a> </li> <li class=md-tabs__item> <a href=../../reference/ class=md-tabs__link> å‚è€ƒ </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=cert-manager class="md-nav__button md-logo" aria-label=cert-manager data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> cert-manager </label> <div class=md-nav__source> <a href=https://github.com/cert-manager/cert-manager title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> cert-manager/cert-manager </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> ç®€ä»‹ </a> </li> <li class=md-nav__item> <a href=../../getting-started/ class=md-nav__link> å…¥é—¨ </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <div class="md-nav__link md-nav__link--index "> <a href=../../installation/ >å®‰è£…</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label=å®‰è£… data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> å®‰è£… </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../installation/supported-releases/ class=md-nav__link> æ”¯æŒç‰ˆæœ¬ </a> </li> <li class=md-nav__item> <a href=../../installation/compatibility/ class=md-nav__link> äº‘å…¼å®¹æ€§ </a> </li> <li class=md-nav__item> <a href=../../installation/kubectl/ class=md-nav__link> kubectl apply </a> </li> <li class=md-nav__item> <a href=../../installation/helm/ class=md-nav__link> Helm </a> </li> <li class=md-nav__item> <a href=../../installation/operator-lifecycle-manager/ class=md-nav__link> OperatorHub (OLM) </a> </li> <li class=md-nav__item> <a href=../../installation/other-tools/ class=md-nav__link> å…¶ä»–å·¥å…· </a> </li> <li class=md-nav__item> <a href=../../installation/verify/ class=md-nav__link> éªŒè¯ </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <div class="md-nav__link md-nav__link--index "> <a href=../../configuration/ >é…ç½®</a> </div> <nav class=md-nav aria-label=é…ç½® data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> é…ç½® </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <div class="md-nav__link md-nav__link--index "> <a href=../../usage/ >ä½¿ç”¨</a> </div> <nav class=md-nav aria-label=ä½¿ç”¨ data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> ä½¿ç”¨ </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <div class="md-nav__link md-nav__link--index "> <a href=../../projects/ >é¡¹ç›®</a> </div> <nav class=md-nav aria-label=é¡¹ç›® data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> é¡¹ç›® </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <div class="md-nav__link md-nav__link--index "> <a href=../ >æ‰‹å†Œ</a> </div> <nav class=md-nav aria-label=æ‰‹å†Œ data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> æ‰‹å†Œ </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <div class="md-nav__link md-nav__link--index "> <a href=../../troubleshooting/ >æ•…éšœæ’é™¤</a> </div> <nav class=md-nav aria-label=æ•…éšœæ’é™¤ data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> æ•…éšœæ’é™¤ </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class=md-nav__item> <a href=../../faq/ class=md-nav__link> FAQ </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10 type=checkbox id=__nav_10> <div class="md-nav__link md-nav__link--index "> <a href=../../contributing/ >è´¡çŒ®</a> </div> <nav class=md-nav aria-label=è´¡çŒ® data-md-level=1> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> è´¡çŒ® </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11 type=checkbox id=__nav_11> <div class="md-nav__link md-nav__link--index "> <a href=../../release-notes/ >å‘å¸ƒè¯´æ˜</a> </div> <nav class=md-nav aria-label=å‘å¸ƒè¯´æ˜ data-md-level=1> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> å‘å¸ƒè¯´æ˜ </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_12 type=checkbox id=__nav_12> <div class="md-nav__link md-nav__link--index "> <a href=../../concepts/ >æ¦‚å¿µ</a> </div> <nav class=md-nav aria-label=æ¦‚å¿µ data-md-level=1> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> æ¦‚å¿µ </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_13 type=checkbox id=__nav_13> <div class="md-nav__link md-nav__link--index "> <a href=../../reference/ >å‚è€ƒ</a> </div> <nav class=md-nav aria-label=å‚è€ƒ data-md-level=1> <label class=md-nav__title for=__nav_13> <span class="md-nav__icon md-icon"></span> å‚è€ƒ </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#0-configure-gcloud-with-a-google-cloud-project class=md-nav__link> 0. Configure gcloud with a Google Cloud project </a> </li> <li class=md-nav__item> <a href=#1-create-a-kubernetes-cluster class=md-nav__link> 1. Create a Kubernetes Cluster </a> </li> <li class=md-nav__item> <a href=#2-deploy-a-sample-web-server class=md-nav__link> 2. Deploy a sample web server </a> </li> <li class=md-nav__item> <a href=#3-create-a-static-external-ip-address class=md-nav__link> 3. Create a static external IP address </a> </li> <li class=md-nav__item> <a href=#4-create-a-domain-name-for-your-website class=md-nav__link> 4. Create a domain name for your website </a> </li> <li class=md-nav__item> <a href=#5-create-an-ingress class=md-nav__link> 5. Create an Ingress </a> </li> <li class=md-nav__item> <a href=#6-install-cert-manager class=md-nav__link> 6. Install cert-manager </a> </li> <li class=md-nav__item> <a href=#7-create-an-issuer-for-lets-encrypt-staging class=md-nav__link> 7. Create an Issuer for Let's Encrypt Staging </a> </li> <li class=md-nav__item> <a href=#8-re-configure-the-ingress-for-ssl class=md-nav__link> 8. Re-configure the Ingress for SSL </a> </li> <li class=md-nav__item> <a href=#9-create-a-production-ready-ssl-certificate class=md-nav__link> 9. Create a production ready SSL certificate </a> </li> <li class=md-nav__item> <a href=#clean-up class=md-nav__link> Clean up </a> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#check-ingress-and-associated-events class=md-nav__link> Check Ingress and associated events </a> </li> <li class=md-nav__item> <a href=#use-cmctl-to-show-the-state-of-a-certificate-and-its-associated-resources class=md-nav__link> Use cmctl to show the state of a Certificate and its associated resources </a> </li> <li class=md-nav__item> <a href=#check-that-the-ssl-certificate-has-been-copied-to-google-cloud class=md-nav__link> Check that the SSL certificate has been copied to Google Cloud </a> </li> <li class=md-nav__item> <a href=#check-the-google-cloud-forwarding-rules class=md-nav__link> Check the Google Cloud forwarding-rules </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/cert-manager/cert-manager/edit/master/docs/tutorials/getting-started-with-cert-manager-on-google-kubernetes-engine-using-lets-encrypt-for-ingress-ssl/README.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>Deploy cert-manager on Google Kubernetes Engine (GKE) and create SSL certificates for Ingress using Let's Encrypt</h1> <p><em>Last Verified: 15 July 2022</em></p> <p>In this tutorial you will learn how to deploy and configure cert-manager on Google Kubernetes Engine (GKE). You will learn how to configure cert-manager to get a signed SSL certificate from Let's Encrypt, using an <a href=https://letsencrypt.org/docs/challenge-types/#http-01-challenge>HTTP-01 challenge</a>. Finally you will learn how the certificate can be used to serve an HTTPS website with a public domain name.</p> <blockquote> <p><strong>Google Cloud</strong>: A suite of cloud computing services by Google.<br> <strong>Kubernetes</strong>: Runs on your servers. Automates the deployment, scaling, and management of containerized applications.<br> <strong>cert-manager</strong>: Runs in Kubernetes. Obtains TLS / SSL certificates and ensures the certificates are valid and up-to-date.<br> <strong>Letâ€™s Encrypt</strong>: An Internet service. Allows you to generate free short-lived SSL certificates.</p> </blockquote> <p>First you will create a Kubernetes (GKE) cluster and deploy a sample web server. You will then create a public IP address and a public domain name for your website. You'll set up Ingress and Google Cloud load balancers so that Internet clients can connect to the web server using HTTP. Finally you will use cert-manager to get an SSL certificate from Let's Encrypt and configure the load balancer to use that certificate. By the end of this tutorial you will be able to connect to your website from the Internet using an <code>https://</code> URL.</p> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <p><strong>ğŸ’» Google Cloud account</strong></p> <p>You will need a Google Cloud account. Registration requires a credit card or bank account details. Visit the <a href=https://cloud.google.com/docs/get-started>Get started with Google Cloud</a> page and follow the instructions.</p> <blockquote> <p>ğŸ’µ If you have never used Google Cloud before, you may be eligible for the <a href=https://cloud.google.com/free/docs/gcp-free-tier/#free-trial>Google Cloud Free Program</a>, which gives you a 90 day trial period that includes $300 in free Cloud Billing credits to explore and evaluate Google Cloud.</p> </blockquote> <p><strong>ğŸ’» Domain Name</strong></p> <p>You will need a domain name and the ability to create DNS records in that domain. We will be getting a $12 domain name from Google Domains. Google Domains is one of the many possible "domain name registrars". NameCheap and GoDaddy are two other well-known registrars.</p> <blockquote> <p>ğŸ’µ If you prefer not purchasing a domain name, it is also possible to adapt this tutorial to use the IP address to serve your website and for the SSL certificate.</p> </blockquote> <p><strong>ğŸ’» Software</strong></p> <p>You will also need to install the following software on your laptop:</p> <ol> <li><a href=https://cloud.google.com/sdk/docs/install>gcloud</a>: A set of tools to create and manage Google Cloud resources.</li> <li><a href=https://kubernetes.io/docs/tasks/tools/#kubectl>kubectl</a>: The Kubernetes command-line tool which allows you to configure Kubernetes clusters.</li> <li><a href=https://everything.curl.dev/get>curl</a>: A command-line tool for connecting to a web server using HTTP and HTTPS.</li> </ol> <blockquote> <p>â„¹ï¸ Try running <code>gcloud components install kubectl</code> to quickly install <code>kubectl</code>.</p> </blockquote> <h2 id=0-configure-gcloud-with-a-google-cloud-project>0. Configure <code>gcloud</code> with a Google Cloud project<a class=headerlink href=#0-configure-gcloud-with-a-google-cloud-project title="Permanent link">&para;</a></h2> <p>If you don't have a Google Cloud account, the command below will create one for you:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>gcloud init
</code></pre></div> <p>You will need to answer "yes" to the following question:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>Do you want to configure a default Compute Region and Zone? (Y/n)?  Y
</code></pre></div> <p>After running the command, you will shown the project name, default region, and default zone.</p> <p>Example output:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>* Commands that require authentication will use firstname.lastname@example.com by default
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>* Commands will reference project `your-project` by default
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>* Compute Engine commands will use region `europe-west1` by default
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>* Compute Engine commands will use zone `europe-west1-b` by default
</code></pre></div> <p>In this tutorial, we will refer to the name of the project that was selected while running <code>gcloud init</code> with the variable <code>PROJECT</code>. Where ever you see <code>$PROJECT</code> in a command, you need to either (1) replace the variable manually before you execute the command, or (2) export the variable in your shell session. This applies to all environment variables that you will encounter in the commands listed in this tutorial.</p> <p>We will go with option (2), so we need to export the environment variables before continuing using the information that was printed by <code>gcloud init</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=nb>export</span> <span class=nv>PROJECT</span><span class=o>=</span>your-project  <span class=c1># Your Google Cloud project ID.</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=nb>export</span> <span class=nv>REGION</span><span class=o>=</span>europe-west1   <span class=c1># Your Google Cloud region.</span>
</code></pre></div> <h2 id=1-create-a-kubernetes-cluster>1. Create a Kubernetes Cluster<a class=headerlink href=#1-create-a-kubernetes-cluster title="Permanent link">&para;</a></h2> <p>To get started, let's create a Kubernetes cluster in Google Cloud. You will need to pick a name for your cluster. Here, we will go with "test-cluster-1". Let us save it in an environment variable:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nb>export</span> <span class=nv>CLUSTER</span><span class=o>=</span>test-cluster-1
</code></pre></div> <p>Now, create the cluster using the following command:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a>gcloud container clusters create <span class=nv>$CLUSTER</span> --preemptible --num-nodes<span class=o>=</span><span class=m>1</span>
</code></pre></div> <p>Set up the <a href=https://cloud.google.com/blog/products/containers-kubernetes/kubectl-auth-changes-in-gke>Google Kubernetes Engine auth plugin for kubectl</a>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>gcloud components install gke-gcloud-auth-plugin
<a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=nb>export</span> <span class=nv>USE_GKE_GCLOUD_AUTH_PLUGIN</span><span class=o>=</span>True
<a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>gcloud container clusters get-credentials <span class=nv>$CLUSTER</span>
</code></pre></div> <p>Now check that you can connect to the cluster:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>kubectl get nodes -o wide
</code></pre></div> <blockquote> <p>â² It will take 4-5 minutes to create the cluster.</p> <p>ğŸ’µ To minimize your cloud bill, this command creates a 1-node cluster using a <a href=https://cloud.google.com/kubernetes-engine/docs/how-to/preemptible-vms>preemptible virtual machine</a> which is cheaper than a normal virtual machine.</p> </blockquote> <h2 id=2-deploy-a-sample-web-server>2. Deploy a sample web server<a class=headerlink href=#2-deploy-a-sample-web-server title="Permanent link">&para;</a></h2> <p>We will deploy a very simple web server which responds to HTTP requests with "hello world!".</p> <div class=highlight><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>kubectl create deployment web --image<span class=o>=</span>gcr.io/google-samples/hello-app:1.0
</code></pre></div> <p>We also need to create a Kubernetes Service, so that connections can be routed to the web server Pods:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>kubectl expose deployment web --port<span class=o>=</span><span class=m>8080</span>
</code></pre></div> <blockquote> <p>â„¹ï¸ These <a href=https://kubernetes.io/docs/tasks/manage-kubernetes-objects/imperative-command/ >kubectl imperative commands</a> are used for readability and brevity. Feel free to use YAML manifests and <code>kubectl apply -f</code> instead.</p> <p>â„¹ï¸ The Service created by <code>kubectl expose</code> will be of type <code>ClusterIP</code> (the default) and this is only reachable by components within the cluster. Later we will create an Ingress which is how we make the service available to clients outside the cluster.</p> <p>ğŸ”° Read more about <a href=https://kubernetes.io/docs/tutorials/kubernetes-basics/expose/expose-intro/ >Using a Service to Expose Your App</a>.</p> </blockquote> <h2 id=3-create-a-static-external-ip-address>3. Create a static external IP address<a class=headerlink href=#3-create-a-static-external-ip-address title="Permanent link">&para;</a></h2> <p>This tutorial is about creating a public facing HTTPS website with a Let's Encrypt SSL certificate using the HTTP01 challenge mechanism, so we need a public IP address so that both Let's Encrypt and other Internet clients can connect to your website.</p> <p>It is easy to create a public IP address in Google Cloud and later we will associate it with your website domain name and with a Google Cloud load balancer, which will accept HTTP(S) connections from Internet clients and proxy the requests to the web servers running in your cluster.</p> <p>Create a global static IP address as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>gcloud compute addresses create web-ip --global
</code></pre></div> <p>You should see the new IP address listed:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>gcloud compute addresses list
</code></pre></div> <blockquote> <p>âš ï¸ You MUST create a <code>global</code> IP address because that is a prerequisite of the <a href=https://cloud.google.com/kubernetes-engine/docs/concepts/ingress-xlb>External HTTP(S) Load Balancer</a> which we will be using in this tutorial.</p> <p>ğŸ’µ Global static IP addresses are only available in the Premium network service tier and are more expensive than ephemeral and standard public IP addresses.</p> <p>ğŸ”° Read more about <a href=https://cloud.google.com/network-tiers>Network service tiers in Google Cloud</a>.</p> <p>ğŸ”° Read more about <a href=https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address>Reserving a static external IP address in Google Cloud</a>.</p> </blockquote> <p>Finally, we will save the IP address into an environment variable for later use. Display the IP address with the following command:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a>gcloud compute addresses describe web-ip --format<span class=o>=</span><span class=s1>&#39;value(address)&#39;</span> --global
</code></pre></div> <p>Then, copy the output and save it into an environment variable:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=nb>export</span> <span class=nv>IP_ADDRESS</span><span class=o>=</span><span class=m>198</span>.51.100.1  <span class=c1># Replace with your IP address</span>
</code></pre></div> <h2 id=4-create-a-domain-name-for-your-website>4. Create a domain name for your website<a class=headerlink href=#4-create-a-domain-name-for-your-website title="Permanent link">&para;</a></h2> <p>You will need a domain name for your website and Let's Encrypt checks your domain before it signs your SSL certificate, so the domain name needs to be reachable from the Internet.</p> <p>We will purchase a cheap domain name using a credit card. Go to <a href=https://domains.google.com>https://domains.google.com</a>, and type something in the search box. For the example, we searched for <code>hello-app.com</code> because the example container that we will be deploying is called <code>hello-app</code>. Most importantly, we make sure to sort the domain names by price:</p> <p><img alt src=/images/getting-started/screenshot_google-domains_get-a-new-domain.png></p> <p>We don't pick <code>hello-app.com</code> because it costs $2,800; instead, we go with the one at the top: <code>heyapp.net</code>. It looks good! We then click the cart button. On the next screen, you will want to disable the auto-renewal, since we don't want to pay for this domain every year:</p> <p><img alt src=/images/getting-started/screenshot_google-domains_your-cart.png></p> <p>Now that you know your domain name, save it in an environment variable:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=nb>export</span> <span class=nv>DOMAIN_NAME</span><span class=o>=</span>heyapp.net
</code></pre></div> <p>Next, you will need to create a new <code>A</code> record pointing at the IP address that we created above. Head back to <a href=https://domains.google.com/registrar>https://domains.google.com/registrar</a>, open your domain (here, <code>heyapp.net</code>) and click "DNS" on the left menu. You will see "Custom records". You want to add a new record of type <code>A</code> and put the IP address from the previous step into "data". You must leave "Host name" empty because we are configuring the top-level domain name:</p> <p><img alt src=/images/getting-started/screenshot_google-domains_resource-records.png></p> <blockquote> <p>ğŸ”° Learn more about <a href=https://www.cloudflare.com/learning/dns/dns-records/dns-a-record/ >What is a DNS A record? from the Cloudflare DNS tutorial</a>.</p> <p>â„¹ï¸ It is not strictly necessary to create a domain name for your website. You can connect to it using the IP address and later you can create an SSL certificate for the IP address instead of a domain name. If for some reason you can't create a domain name, then feel free to skip this section and adapt the instructions below to use an IP address instead.</p> <p>â„¹ï¸ Every Google Cloud address has an automatically generated reverse DNS name like <code>51.159.120.34.bc.googleusercontent.com</code>, but the parent domain <code>googleusercontent.com</code> has a CAA record which prevents Let's Encrypt from signing certificates for the sub-domains. See <a href=https://letsencrypt.org/docs/caa/ >Certificate Authority Authorization (CAA)</a> in the Let's Encrypt documentation.</p> </blockquote> <h2 id=5-create-an-ingress>5. Create an Ingress<a class=headerlink href=#5-create-an-ingress title="Permanent link">&para;</a></h2> <p>You won't be able to reach your website yet. Your web server is running inside your Kubernetes cluster but there is no route or proxy through which Internet clients can connect to it, yet! Now we will create a Kubernetes Ingress object and in Google Cloud this will trigger the creation of a various services which together allow Internet clients to reach your web server running inside your Kubernetes cluster.</p> <p>Initially we are going to create an HTTP (not an HTTPS) Ingress so that we can test the basic connectivity before adding the SSL layer.</p> <p>Copy the following YAML into a file called <code>ingress.yaml</code> and apply it:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=c1># ingress.yaml</span><span class=w></span>
<a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span><span class=w></span>
<a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span><span class=w></span>
<a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web-ingress</span><span class=w></span>
<a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>    </span><span class=c1># This tells Google Cloud to create an External Load Balancer to realize this Ingress</span><span class=w></span>
<a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=w>    </span><span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gce</span><span class=w></span>
<a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=w>    </span><span class=c1># This enables HTTP connections from Internet clients</span><span class=w></span>
<a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=w>    </span><span class=nt>kubernetes.io/ingress.allow-http</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span><span class=w></span>
<a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=w>    </span><span class=c1># This tells Google Cloud to associate the External Load Balancer with the static IP which we created earlier</span><span class=w></span>
<a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=w>    </span><span class=nt>kubernetes.io/ingress.global-static-ip-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web-ip</span><span class=w></span>
<a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=w>  </span><span class=nt>defaultBackend</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span><span class=w></span>
<a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=w>        </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">8080</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>kubectl apply -f ingress.yaml
</code></pre></div> <p>This will trigger the creation of a Google HTTP(S) loadbalancer associated with the IP address that you created earlier. You can watch the progress and the resources that are being created:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>kubectl describe ingress web-ingress
</code></pre></div> <p>Within 4-5 minutes all the load balancer components should be ready and you should be able to connect to the DNS name and see the response from the hello-world web server that we deployed earlier:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a>curl http://$DOMAIN_NAME
</code></pre></div> <p>Example output:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=go>Hello, world!</span>
<a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=go>Version: 1.0.0</span>
<a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=go>Hostname: web-79d88c97d6-t8hj2</span>
</code></pre></div> <p>At this point we have a Google load balancer which is forwarding HTTP traffic to the hello-world web server running in a Pod in our cluster.</p> <blockquote> <p>â² It may take 4-5 minutes for the load balancer components to be created and configured and for Internet clients to be routed to your web server. Refer to the <a href=#troubleshooting>Troubleshooting</a> section if it takes longer.</p> <p>ğŸ”° Read about how to <a href=https://cloud.google.com/kubernetes-engine/docs/concepts/ingress-xlb#static_ip_addresses_for_https_load_balancers>Use a static IP addresses for HTTP(S) load balancers via Ingress annotation</a>.</p> <p>ğŸ”° Read a <a href=https://cloud.google.com/kubernetes-engine/docs/how-to/load-balance-ingress#summary_of_external_ingress_annotations>Summary of external Ingress annotations for GKE</a>.</p> <p>ğŸ”° Read about <a href=https://cloud.google.com/kubernetes-engine/docs/how-to/load-balance-ingress#testing_the>Troubleshooting Ingress with External HTTP(S) Load Balancing on GKE</a>.</p> <p>â„¹ï¸ There are two Ingress classes available for GKE Ingress. The <code>gce</code> class deploys an external load balancer and the <code>gce-internal</code> class deploys an internal load balancer. Ingress resources without a class specified default to <code>gce</code>.</p> <p>âš ï¸ Contrary to the Kubernetes Ingress documentation, you MUST use the <code>kubernetes.io/ingress.class</code> annotation rather than the <code>Ingress.Spec.IngressClassName</code> field. See <a href=https://github.com/kubernetes/ingress-gce/issues/1301#issuecomment-1133356812>ingress-gce #1301</a> and <a href=https://github.com/kubernetes/ingress-gce/pull/1337>ingress-gce #1337</a>.</p> </blockquote> <h2 id=6-install-cert-manager>6. Install cert-manager<a class=headerlink href=#6-install-cert-manager title="Permanent link">&para;</a></h2> <p>So finally we are ready to start creating an SSL certificate for our website. The first thing you need to do is install cert-manager, and we'll install it the easy using <code>kubectl</code> as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.8.2/cert-manager.yaml
</code></pre></div> <p>This will create three Deployments, and a bunch of Services and Pods in a new namespace called <code>cert-manager</code>. It also installs various cluster scoped supporting resources such as RBAC roles and Custom Resource Definitions.</p> <p>You can view some of the resources that have been installed as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>kubectl -n cert-manager get all
</code></pre></div> <p>And you can explore the Custom Resource Definitions (cert-manager's API) using <code>kubectl explain</code>, as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a>kubectl explain Certificate
<a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>kubectl explain CertificateRequest
<a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>kubectl explain Issuer
</code></pre></div> <blockquote> <p>ğŸ”° Read about <a href=../../installation>other ways to install cert-manager</a>.</p> <p>ğŸ”° Read more about <a href=../../concepts>Certificates and Issuers</a>.</p> </blockquote> <h2 id=7-create-an-issuer-for-lets-encrypt-staging>7. Create an Issuer for Let's Encrypt Staging<a class=headerlink href=#7-create-an-issuer-for-lets-encrypt-staging title="Permanent link">&para;</a></h2> <p>An Issuer is a custom resource which tells cert-manager how to sign a Certificate. In this case the Issuer will be configured to connect to the Let's Encrypt staging server, which allows us to test everything without using up our Let's Encrypt certificate quota for the domain name.</p> <blockquote> <p>â„¹ï¸ Let's Encrypt uses the Automatic Certificate Management Environment (ACME) protocol which is why the configuration below is under a key called <code>acme</code>.</p> </blockquote> <p>Save the following content to a file called <code>issuer-lets-encrypt-staging.yaml</code>, change the <code>email</code> field to use your email address and apply it:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># issuer-lets-encrypt-staging.yaml</span><span class=w></span>
<a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span><span class=w></span>
<a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Issuer</span><span class=w></span>
<a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-staging</span><span class=w></span>
<a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=w>  </span><span class=nt>acme</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://acme-staging-v02.api.letsencrypt.org/directory</span><span class=w></span>
<a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>    </span><span class=nt>email</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;email-address&gt;</span><span class=w> </span><span class=c1># â— Replace this with your email address</span><span class=w></span>
<a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=w>    </span><span class=nt>privateKeySecretRef</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-staging</span><span class=w></span>
<a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=w>    </span><span class=nt>solvers</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>http01</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=w>        </span><span class=nt>ingress</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web-ingress</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a>kubectl apply -f issuer-lets-encrypt-staging.yaml
</code></pre></div> <blockquote> <p>â„¹ï¸ The email address is only used by Let's Encrypt to remind you to renew the certificate after 30 days before expiry. You will only receive this email if something goes wrong when renewing the certificate with cert-manager.</p> </blockquote> <p>You can check the status of the Issuer:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a>kubectl describe issuers.cert-manager.io letsencrypt-staging
</code></pre></div> <p>Example output</p> <div class=highlight><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=go>Status:</span>
<a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=go>  Acme:</span>
<a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=go>    Last Registered Email:  firstname.lastname@example.com</span>
<a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=go>    Uri:                    https://acme-staging-v02.api.letsencrypt.org/acme/acct/60706744</span>
<a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=go>  Conditions:</span>
<a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=go>    Last Transition Time:  2022-07-13T16:13:25Z</span>
<a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=go>    Message:               The ACME account was registered with the ACME server</span>
<a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=go>    Observed Generation:   1</span>
<a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=go>    Reason:                ACMEAccountRegistered</span>
<a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=go>    Status:                True</span>
<a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=go>    Type:                  Ready</span>
</code></pre></div> <blockquote> <p>â„¹ï¸ The Let's Encrypt production issuer has <a href=https://letsencrypt.org/docs/rate-limits/ >very strict rate limits</a>. When you're experimenting and learning, it can be very easy to hit those limits. Because of that risk, we'll start with the Let's Encrypt staging issuer, and once we're happy that it's working we'll switch to the production issuer.</p> <p>âš ï¸ In the next step you will see a warning about untrusted certificates because we start with the staging issuer, but that's totally expected.</p> <p>ğŸ”° Read more about <a href=../../configuration/acme>configuring the ACME Issuer</a>.</p> </blockquote> <h2 id=8-re-configure-the-ingress-for-ssl>8. Re-configure the Ingress for SSL<a class=headerlink href=#8-re-configure-the-ingress-for-ssl title="Permanent link">&para;</a></h2> <p>Earlier we created an Ingress and saw that we could connect to our web server using HTTP. Now we will reconfigure that Ingress for HTTPS.</p> <p>First a quick hack, to work around a problem with the Google Cloud ingress controller. Create an empty Secret for your SSL certificate <strong>before reconfiguring the Ingress</strong> and apply it:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># secret.yaml</span><span class=w></span>
<a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class=w></span>
<a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web-ssl</span><span class=w></span>
<a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/tls</span><span class=w></span>
<a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=nt>stringData</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=w>  </span><span class=nt>tls.key</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w></span>
<a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=w>  </span><span class=nt>tls.crt</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a>kubectl apply -f secret.yaml
</code></pre></div> <blockquote> <p>â„¹ï¸ This is a work around for a chicken-and-egg problem, where the ingress-gce controller won't update its forwarding rules unless it can first find the Secret that will eventually contain the SSL certificate. But Let's Encrypt won't sign the SSL certificate until it can get the special <code>.../.well-known/acme-challenge/...</code> URL which cert-manager adds to the Ingress and which must then be translated into Google Cloud forwarding rules, by the ingress-gce controller.</p> <p>ğŸ”° Read more about <a href=https://kubernetes.io/docs/concepts/configuration/secret/ >Kubernetes Secrets and how to use them</a>.</p> </blockquote> <p>Now make the following changes to the Ingress and apply them:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=gd>--- a/ingress.yaml</span><span class=w></span>
<a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=gi>+++ b/ingress.yaml</span><span class=w></span>
<a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=gu>@@ -7,7 +7,12 @@ metadata:</span><span class=w></span>
<a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=w> </span>    kubernetes.io/ingress.class: gce<span class=w></span>
<a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=w> </span>    kubernetes.io/ingress.allow-http: &quot;true&quot;<span class=w></span>
<a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=w> </span>    kubernetes.io/ingress.global-static-ip-name: web-ip<span class=w></span>
<a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=gi>+    cert-manager.io/issuer: letsencrypt-staging</span><span class=w></span>
<a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=w> </span>spec:<span class=w></span>
<a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=gi>+  tls:</span><span class=w></span>
<a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=gi>+    - secretName: web-ssl</span><span class=w></span>
<a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=gi>+      hosts:</span><span class=w></span>
<a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=gi>+        - $DOMAIN_NAME</span><span class=w></span>
<a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=w> </span>  defaultBackend:<span class=w></span>
<a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=w> </span>    service:<span class=w></span>
<a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a><span class=w> </span>      name: web<span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>kubectl apply -f ingress.yaml
</code></pre></div> <p>This triggers a complex set of operations which may take many minutes to eventually complete. Some of these steps take 2-3 minutes and some will initially fail. They should all eventually succeed because cert-manager and ingress-gce (the Google Cloud ingress controller) will periodically re-reconcile.</p> <p>Eventually, When all the pieces are in place, you should be able to use curl to check the HTTPS connection to your website:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a>curl -v --insecure https://<span class=nv>$DOMAIN_NAME</span>
</code></pre></div> <p>You should see that the HTTPS connection is established but that the SSL certificate is not trusted; that's why you use the <code>--insecure</code> flag at this stage</p> <p>Example output: <div class=highlight><pre><span></span><code><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=go>* Server certificate:</span>
<a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=go>*  subject: CN=www.example.com</span>
<a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=go>*  start date: Jul 14 08:52:29 2022 GMT</span>
<a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=go>*  expire date: Oct 12 08:52:28 2022 GMT</span>
<a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=go>*  issuer: C=US; O=(STAGING) Let&#39;s Encrypt; CN=(STAGING) Artificial Apricot R3</span>
<a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=go>*  SSL certificate verify result: unable to get local issuer certificate (20), continuing anyway.</span>
</code></pre></div></p> <blockquote> <p>â² You will have to wait 5-10 minutes for the SSL certificate to be signed and then loaded by the Google Cloud load balancer. Refer to the <a href=#troubleshooting>Troubleshooting</a> section if it takes longer.</p> <p>â„¹ï¸ Adding the annotation <code>cert-manager.io/issuer: letsencrypt-staging</code> marks the Ingress for the attention of the cert-manager <code>ingress-shim</code> and causes it to create a new Certificate with a reference to the Issuer that we created earlier.</p> <p>ğŸ”° Read <a href=../../usage/ingress>Securing Ingress Resources</a> to learn more.</p> <p>ğŸ”° Read about how to <a href=https://cloud.google.com/kubernetes-engine/docs/how-to/ingress-multi-ssl#specifying_certificates_for_your_ingress>Specify certificates for your Ingress in GKE</a>.</p> </blockquote> <h2 id=9-create-a-production-ready-ssl-certificate>9. Create a production ready SSL certificate<a class=headerlink href=#9-create-a-production-ready-ssl-certificate title="Permanent link">&para;</a></h2> <p>Now that everything is working with the Let's Encrypt staging server, we can switch to the production server and get a trusted SSL certificate.</p> <p>Create a Let's Encrypt production Issuer and apply it:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1># issuer-lets-encrypt-production.yaml</span><span class=w></span>
<a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span><span class=w></span>
<a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Issuer</span><span class=w></span>
<a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-production</span><span class=w></span>
<a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=nt>spec</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=w>  </span><span class=nt>acme</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://acme-v02.api.letsencrypt.org/directory</span><span class=w></span>
<a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=w>    </span><span class=nt>email</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;email-address&gt;</span><span class=w> </span><span class=c1># â— Replace this with your email address</span><span class=w></span>
<a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=w>    </span><span class=nt>privateKeySecretRef</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-production</span><span class=w></span>
<a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a><span class=w>    </span><span class=nt>solvers</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>http01</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a><span class=w>        </span><span class=nt>ingress</span><span class=p>:</span><span class=w></span>
<a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web-ingress</span><span class=w></span>
</code></pre></div> <div class=highlight><pre><span></span><code><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>kubectl apply -f issuer-lets-encrypt-production.yaml
</code></pre></div> <p>Then update the Ingress annotation to use the production Issuer:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a>kubectl annotate ingress web-ingress cert-manager.io/issuer<span class=o>=</span>letsencrypt-production --overwrite
</code></pre></div> <p>This will trigger cert-manager to get a new SSL certificate signed by the Let's Encrypt production CA and store it to the <code>web-ssl</code> Secret. Within about 10 minutes, this new certificate will be synced to the Google Cloud load balancer and you will be able to connect to the website using secure HTTPS:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>curl -v https://<span class=nv>$DOMAIN_NAME</span>
</code></pre></div> <p>Example output: <div class=highlight><pre><span></span><code><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=go>...</span>
<a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=go>* Server certificate:</span>
<a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=go>*  subject: CN=www.example.com</span>
<a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=go>*  start date: Jul 14 09:44:29 2022 GMT</span>
<a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=go>*  expire date: Oct 12 09:44:28 2022 GMT</span>
<a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=go>*  subjectAltName: host &quot;www.example.com&quot; matched cert&#39;s &quot;www.example.com&quot;</span>
<a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=go>*  issuer: C=US; O=Let&#39;s Encrypt; CN=R3</span>
<a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=go>*  SSL certificate verify ok.</span>
<a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=go>...</span>
<a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class=go>Hello, world!</span>
<a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class=go>Version: 1.0.0</span>
<a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a><span class=go>Hostname: web-79d88c97d6-t8hj2</span>
</code></pre></div></p> <p>It should also be possible to visit <code>https://$DOMAIN_NAME</code> in your web browser, without any errors or warnings.</p> <p>That concludes the tutorial. You now understand how cert-manager integrates with Kubernetes Ingress and cloud Ingress controllers. You have learned how to use cert-manager to get free Let's Encrypt SSL certificates. And you have seen how the certificates can be used by a cloud based load balancer to terminate SSL connections from Internet clients and forward HTTPS requests to a web server running in your Kubernetes cluster.</p> <blockquote> <p>ğŸ’µ Read the <a href=#clean-up>Clean up</a> section to learn how to delete all the resources that you created in this tutorial and reduce your cloud bill.</p> <p>ğŸ”° Read the <a href=#troubleshooting>Troubleshooting</a> section if you encounter difficulties with the steps described in this tutorial.</p> </blockquote> <h2 id=clean-up>Clean up<a class=headerlink href=#clean-up title="Permanent link">&para;</a></h2> <p>After completing the tutorial you can clean up by deleting the cluster and the domain name and the static IP as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=c1># Delete the cluster and all the Google Cloud resources related to the Ingress that it contains</span>
<a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>gcloud container clusters delete <span class=nv>$CLUSTER</span>
<a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>
<a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=c1># Delete the domain name</span>
<a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a>gcloud dns record-sets delete <span class=nv>$DOMAIN_NAME</span> --zone <span class=nv>$ZONE</span> --type A
<a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a>
<a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=c1># Delete the static IP address</span>
<a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a>gcloud compute addresses delete web-ip --global
</code></pre></div> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h2> <p>When you create or update the Ingress object in this tutorial it triggers a complex set of operations which may take many minutes to eventually complete. Some of these steps take 2-3 minutes and some will initially fail but then subsequently succeed when either cert-manager or the Google ingress controller re-reconciles. In short, you should allow 5-10 minutes after you create or change the Ingress and you should expect to see some errors and warnings when you run <code>kubectl describe ingress web-ingress</code>.</p> <p>Here's a brief summary of the operations performed by cert-manager and ingress-gce (the Google Cloud Ingress controller):</p> <ul> <li>cert-manager connects to Let's Encrypt and sends an SSL certificate signing request.</li> <li>Let's Encrypt responds with a "challenge", which is a unique token that cert-manager must make available at a well-known location on the target web site. This proves that you are an administrator of that web site and domain name.</li> <li>cert-manager deploys a Pod containing a temporary web server that serves the Let's Encrypt challenge token.</li> <li>cert-manager reconfigures the Ingress, adding a <code>rule</code> to route requests for from Let's Encrypt to that temporary web server.</li> <li>Google Cloud ingress controller reconfigures the external HTTP load balancer with that new rule.</li> <li>Let's Encrypt now connects and receives the expected challenge token and the signs the SSL certificate and returns it to cert-manager.</li> <li>cert-manager stores the signed SSL certificate in the Kubernetes Secret called <code>web-ssl</code>.</li> <li>Google Cloud ingress controller uploads the signed certificate and associated private key to a Google Cloud certificate.</li> <li>Google Cloud ingress controller reconfigures the external load balancer to serve the uploaded SSL certificate.</li> </ul> <h3 id=check-ingress-and-associated-events>Check Ingress and associated events<a class=headerlink href=#check-ingress-and-associated-events title="Permanent link">&para;</a></h3> <p>Use <code>kubectl describe</code> to view the Ingress configuration and all the associated Events. Check that the IP address is correct and that the TLS and Host entries match the domain name that you chose for your website. Notice that <code>ingress-gce</code> creates an Event for each of the Google Cloud components that it manages. And notice that it adds annotations with references to the ID of each of those components. cert-manager also creates Events when it reconciles the Ingress object, including details of the Certificate object that it creates for the Ingress.</p> <div class=highlight><pre><span></span><code><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=gp>$ </span>kubectl describe ingress web-ingress
<a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=go>Name:             web-ingress</span>
<a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=go>Labels:           &lt;none&gt;</span>
<a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=go>Namespace:        default</span>
<a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=go>Address:          34.120.159.51</span>
<a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=go>Ingress Class:    &lt;none&gt;</span>
<a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=go>Default backend:  web:8080 (10.52.0.13:8080)</span>
<a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=go>TLS:</span>
<a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=go>  web-ssl terminates www.example.com</span>
<a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=go>Rules:</span>
<a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=go>  Host        Path  Backends</span>
<a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a><span class=go>  ----        ----  --------</span>
<a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=go>  *           *     web:8080 (10.52.0.13:8080)</span>
<a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a><span class=go>Annotations:  cert-manager.io/issuer: letsencrypt-staging</span>
<a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a><span class=go>              ingress.kubernetes.io/backends: {&quot;k8s1-01784147-default-web-8080-1647ccd2&quot;:&quot;HEALTHY&quot;}</span>
<a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a><span class=go>              ingress.kubernetes.io/forwarding-rule: k8s2-fr-1lt9dzcy-default-web-ingress-yteotwe4</span>
<a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=go>              ingress.kubernetes.io/https-forwarding-rule: k8s2-fs-1lt9dzcy-default-web-ingress-yteotwe4</span>
<a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a><span class=go>              ingress.kubernetes.io/https-target-proxy: k8s2-ts-1lt9dzcy-default-web-ingress-yteotwe4</span>
<a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a><span class=go>              ingress.kubernetes.io/ssl-cert: k8s2-cr-1lt9dzcy-4gjeakdb9n7k6ls7-a257650b5fefd174</span>
<a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a><span class=go>              ingress.kubernetes.io/target-proxy: k8s2-tp-1lt9dzcy-default-web-ingress-yteotwe4</span>
<a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a><span class=go>              ingress.kubernetes.io/url-map: k8s2-um-1lt9dzcy-default-web-ingress-yteotwe4</span>
<a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a><span class=go>              kubernetes.io/ingress.allow-http: true</span>
<a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a><span class=go>              kubernetes.io/ingress.class: gce</span>
<a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a><span class=go>              kubernetes.io/ingress.global-static-ip-name: web-ip</span>
<a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a><span class=go>Events:</span>
<a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a><span class=go>  Type     Reason             Age                 From                       Message</span>
<a id=__codelineno-39-27 name=__codelineno-39-27 href=#__codelineno-39-27></a><span class=go>  ----     ------             ----                ----                       -------</span>
<a id=__codelineno-39-28 name=__codelineno-39-28 href=#__codelineno-39-28></a><span class=go>  Normal   CreateCertificate  28m                 cert-manager-ingress-shim  Successfully created Certificate &quot;web-ssl&quot;</span>
<a id=__codelineno-39-29 name=__codelineno-39-29 href=#__codelineno-39-29></a><span class=go>  Normal   Sync               28m                 loadbalancer-controller    UrlMap &quot;k8s2-um-1lt9dzcy-default-web-ingress-yteotwe4&quot; updated</span>
<a id=__codelineno-39-30 name=__codelineno-39-30 href=#__codelineno-39-30></a><span class=go>  Warning  Sync               24m (x16 over 28m)  loadbalancer-controller    Error syncing to GCP: error running load balancer syncing routine: loadbalancer 1lt9dzcy-default-web-ingress-yteotwe4 does not exist: googleapi: Error 404: The resource &#39;projects/your-project/global/sslCertificates/k8s2-cr-1lt9dzcy-4gjeakdb9n7k6ls7-e3b0c44298fc1c14&#39; was not found, notFound</span>
<a id=__codelineno-39-31 name=__codelineno-39-31 href=#__codelineno-39-31></a><span class=go>  Normal   Sync               34s (x16 over 65m)  loadbalancer-controller    Scheduled for sync</span>
</code></pre></div> <h3 id=use-cmctl-to-show-the-state-of-a-certificate-and-its-associated-resources>Use cmctl to show the state of a Certificate and its associated resources<a class=headerlink href=#use-cmctl-to-show-the-state-of-a-certificate-and-its-associated-resources title="Permanent link">&para;</a></h3> <blockquote> <p>â„¹ï¸ <a href=../../reference/cmctl>Install <code>cmctl</code></a> if you have not already done so.</p> </blockquote> <p>When you create a Certificate, cert-manager will create a collection of temporary resources which each contain information about the status of certificate signing process. You can read more about these in the <a href=../../concepts/certificate#certificate-lifecycle>Certificate Lifecycle</a> section. Use the <code>cmctl status</code> command to view details of all these resources and all the associated Events and error messages.</p> <p>You may see some temporary errors, like:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=gp>$ </span>cmctl status certificate web-ssl
<a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=go>Name: web-ssl</span>
<a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=go>Namespace: default</span>
<a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=go>Created at: 2022-07-14T17:30:06+01:00</span>
<a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=go>Conditions:</span>
<a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=go>  Ready: False, Reason: MissingData, Message: Issuing certificate as Secret does not contain a private key</span>
<a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=go>  Issuing: True, Reason: MissingData, Message: Issuing certificate as Secret does not contain a private key</span>
<a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=go>DNS Names:</span>
<a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=go>- www.example.com</span>
<a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=go>Events:</span>
<a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=go>  Type    Reason     Age    From                                       Message</span>
<a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=go>  ----    ------     ----   ----                                       -------</span>
<a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=go>  Normal  Issuing    4m37s  cert-manager-certificates-trigger          Issuing certificate as Secret does not contain a private key</span>
<a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=go>  Normal  Generated  4m37s  cert-manager-certificates-key-manager      Stored new private key in temporary Secret resource &quot;web-ssl-8gsqc&quot;</span>
<a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=go>  Normal  Requested  4m37s  cert-manager-certificates-request-manager  Created new CertificateRequest resource &quot;web-ssl-dblrj&quot;</span>
<a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a><span class=go>Issuer:</span>
<a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=go>  Name: letsencrypt-staging</span>
<a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a><span class=go>  Kind: Issuer</span>
<a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a><span class=go>  Conditions:</span>
<a id=__codelineno-40-20 name=__codelineno-40-20 href=#__codelineno-40-20></a><span class=go>    Ready: True, Reason: ACMEAccountRegistered, Message: The ACME account was registered with the ACME server</span>
<a id=__codelineno-40-21 name=__codelineno-40-21 href=#__codelineno-40-21></a><span class=go>  Events:  &lt;none&gt;</span>
<a id=__codelineno-40-22 name=__codelineno-40-22 href=#__codelineno-40-22></a><span class=go>error: &#39;tls.crt&#39; of Secret &quot;web-ssl&quot; is not set</span>
<a id=__codelineno-40-23 name=__codelineno-40-23 href=#__codelineno-40-23></a><span class=go>Not Before: &lt;none&gt;</span>
<a id=__codelineno-40-24 name=__codelineno-40-24 href=#__codelineno-40-24></a><span class=go>Not After: &lt;none&gt;</span>
<a id=__codelineno-40-25 name=__codelineno-40-25 href=#__codelineno-40-25></a><span class=go>Renewal Time: &lt;none&gt;</span>
<a id=__codelineno-40-26 name=__codelineno-40-26 href=#__codelineno-40-26></a><span class=go>CertificateRequest:</span>
<a id=__codelineno-40-27 name=__codelineno-40-27 href=#__codelineno-40-27></a><span class=go>  Name: web-ssl-dblrj</span>
<a id=__codelineno-40-28 name=__codelineno-40-28 href=#__codelineno-40-28></a><span class=go>  Namespace: default</span>
<a id=__codelineno-40-29 name=__codelineno-40-29 href=#__codelineno-40-29></a><span class=go>  Conditions:</span>
<a id=__codelineno-40-30 name=__codelineno-40-30 href=#__codelineno-40-30></a><span class=go>    Approved: True, Reason: cert-manager.io, Message: Certificate request has been approved by cert-manager.io</span>
<a id=__codelineno-40-31 name=__codelineno-40-31 href=#__codelineno-40-31></a><span class=go>  Ready: False, Reason: Pending, Message: Waiting on certificate issuance from order default/web-ssl-dblrj-327645514: &quot;pending&quot;</span>
<a id=__codelineno-40-32 name=__codelineno-40-32 href=#__codelineno-40-32></a><span class=go>  Events:</span>
<a id=__codelineno-40-33 name=__codelineno-40-33 href=#__codelineno-40-33></a><span class=go>    Type    Reason           Age    From                                          Message</span>
<a id=__codelineno-40-34 name=__codelineno-40-34 href=#__codelineno-40-34></a><span class=go>    ----    ------           ----   ----                                          -------</span>
<a id=__codelineno-40-35 name=__codelineno-40-35 href=#__codelineno-40-35></a><span class=go>    Normal  cert-manager.io  4m37s  cert-manager-certificaterequests-approver     Certificate request has been approved by cert-manager.io</span>
<a id=__codelineno-40-36 name=__codelineno-40-36 href=#__codelineno-40-36></a><span class=go>    Normal  OrderCreated     4m37s  cert-manager-certificaterequests-issuer-acme  Created Order resource default/web-ssl-dblrj-327645514</span>
<a id=__codelineno-40-37 name=__codelineno-40-37 href=#__codelineno-40-37></a><span class=go>    Normal  OrderPending     4m37s  cert-manager-certificaterequests-issuer-acme  Waiting on certificate issuance from order default/web-ssl-dblrj-327645514: &quot;&quot;</span>
<a id=__codelineno-40-38 name=__codelineno-40-38 href=#__codelineno-40-38></a><span class=go>Order:</span>
<a id=__codelineno-40-39 name=__codelineno-40-39 href=#__codelineno-40-39></a><span class=go>  Name: web-ssl-dblrj-327645514</span>
<a id=__codelineno-40-40 name=__codelineno-40-40 href=#__codelineno-40-40></a><span class=go>  State: pending, Reason:</span>
<a id=__codelineno-40-41 name=__codelineno-40-41 href=#__codelineno-40-41></a><span class=go>  Authorizations:</span>
<a id=__codelineno-40-42 name=__codelineno-40-42 href=#__codelineno-40-42></a><span class=go>    URL: https://acme-staging-v02.api.letsencrypt.org/acme/authz-v3/3008789144, Identifier: www.example.com, Initial State: pending, Wildcard: false</span>
<a id=__codelineno-40-43 name=__codelineno-40-43 href=#__codelineno-40-43></a><span class=go>Challenges:</span>
<a id=__codelineno-40-44 name=__codelineno-40-44 href=#__codelineno-40-44></a><span class=go>- Name: web-ssl-dblrj-327645514-2671694319, Type: HTTP-01, Token: TKspp86xMjQzTvMVXWkezEA2sE2GSWjnld5Lt4X13ro, Key: TKspp86xMjQzTvMVXWkezEA2sE2GSWjnld5Lt4X13ro.f4bppCOm-jXasFGMKjpBE5aQlhiQBeTPIs0Lx822xao, State: pending, Reason: Waiting for HTTP-01 challenge propagation: did not get expected response when querying endpoint, expected &quot;TKspp86xMjQzTvMVXWkezEA2sE2GSWjnld5Lt4X13ro.f4bppCOm-jXasFGMKjpBE5aQlhiQBeTPIs0Lx822xao&quot; but got: Hello, world!</span>
<a id=__codelineno-40-45 name=__codelineno-40-45 href=#__codelineno-40-45></a><span class=go>Version: 1... (truncated), Processing: true, Presented: true</span>
</code></pre></div> <p>This is because cert-manager is performing a preflight check to see if the temporary challenge web server is reachable at the expected URL. Initially it will not be reachable, because cert-manager takes some time to deploy the temporary web server and the Ingress controller takes time to set up the new HTTP routing rules. Eventually you will see that the Certificate is Ready and signed:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=gp>$ </span>cmctl status certificate web-ssl
<a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=go>Name: web-ssl</span>
<a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=go>Namespace: default</span>
<a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=go>Created at: 2022-07-14T17:30:06+01:00</span>
<a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=go>Conditions:</span>
<a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=go>  Ready: True, Reason: Ready, Message: Certificate is up to date and has not expired</span>
<a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=go>DNS Names:</span>
<a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=go>- www.example.com</span>
<a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=go>Events:</span>
<a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=go>  Type    Reason     Age   From                                       Message</span>
<a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=go>  ----    ------     ----  ----                                       -------</span>
<a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=go>  Normal  Issuing    31m   cert-manager-certificates-trigger          Issuing certificate as Secret does not contain a private key</span>
<a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a><span class=go>  Normal  Generated  31m   cert-manager-certificates-key-manager      Stored new private key in temporary Secret resource &quot;web-ssl-8gsqc&quot;</span>
<a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=go>  Normal  Requested  31m   cert-manager-certificates-request-manager  Created new CertificateRequest resource &quot;web-ssl-dblrj&quot;</span>
<a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a><span class=go>  Normal  Issuing    26m   cert-manager-certificates-issuing          The certificate has been successfully issued</span>
<a id=__codelineno-41-16 name=__codelineno-41-16 href=#__codelineno-41-16></a><span class=go>Issuer:</span>
<a id=__codelineno-41-17 name=__codelineno-41-17 href=#__codelineno-41-17></a><span class=go>  Name: letsencrypt-staging</span>
<a id=__codelineno-41-18 name=__codelineno-41-18 href=#__codelineno-41-18></a><span class=go>  Kind: Issuer</span>
<a id=__codelineno-41-19 name=__codelineno-41-19 href=#__codelineno-41-19></a><span class=go>  Conditions:</span>
<a id=__codelineno-41-20 name=__codelineno-41-20 href=#__codelineno-41-20></a><span class=go>    Ready: True, Reason: ACMEAccountRegistered, Message: The ACME account was registered with the ACME server</span>
<a id=__codelineno-41-21 name=__codelineno-41-21 href=#__codelineno-41-21></a><span class=go>  Events:  &lt;none&gt;</span>
<a id=__codelineno-41-22 name=__codelineno-41-22 href=#__codelineno-41-22></a><span class=go>Secret:</span>
<a id=__codelineno-41-23 name=__codelineno-41-23 href=#__codelineno-41-23></a><span class=go>  Name: web-ssl</span>
<a id=__codelineno-41-24 name=__codelineno-41-24 href=#__codelineno-41-24></a><span class=go>  Issuer Country: US</span>
<a id=__codelineno-41-25 name=__codelineno-41-25 href=#__codelineno-41-25></a><span class=go>  Issuer Organisation: (STAGING) Let&#39;s Encrypt</span>
<a id=__codelineno-41-26 name=__codelineno-41-26 href=#__codelineno-41-26></a><span class=go>  Issuer Common Name: (STAGING) Artificial Apricot R3</span>
<a id=__codelineno-41-27 name=__codelineno-41-27 href=#__codelineno-41-27></a><span class=go>  Key Usage: Digital Signature, Key Encipherment</span>
<a id=__codelineno-41-28 name=__codelineno-41-28 href=#__codelineno-41-28></a><span class=go>  Extended Key Usages: Server Authentication, Client Authentication</span>
<a id=__codelineno-41-29 name=__codelineno-41-29 href=#__codelineno-41-29></a><span class=go>  Public Key Algorithm: RSA</span>
<a id=__codelineno-41-30 name=__codelineno-41-30 href=#__codelineno-41-30></a><span class=go>  Signature Algorithm: SHA256-RSA</span>
<a id=__codelineno-41-31 name=__codelineno-41-31 href=#__codelineno-41-31></a><span class=go>  Subject Key ID: a51e3621f5c1138947810f27dce425b33c88cb16</span>
<a id=__codelineno-41-32 name=__codelineno-41-32 href=#__codelineno-41-32></a><span class=go>  Authority Key ID: de727a48df31c3a650df9f8523df57374b5d2e65</span>
<a id=__codelineno-41-33 name=__codelineno-41-33 href=#__codelineno-41-33></a><span class=go>  Serial Number: fa8bb0b603ca2cdbfdfb2872d05ee52cda10</span>
<a id=__codelineno-41-34 name=__codelineno-41-34 href=#__codelineno-41-34></a><span class=go>  Events:  &lt;none&gt;</span>
<a id=__codelineno-41-35 name=__codelineno-41-35 href=#__codelineno-41-35></a><span class=go>Not Before: 2022-07-14T16:34:52+01:00</span>
<a id=__codelineno-41-36 name=__codelineno-41-36 href=#__codelineno-41-36></a><span class=go>Not After: 2022-10-12T16:34:51+01:00</span>
<a id=__codelineno-41-37 name=__codelineno-41-37 href=#__codelineno-41-37></a><span class=go>Renewal Time: 2022-09-12T16:34:51+01:00</span>
</code></pre></div> <h3 id=check-that-the-ssl-certificate-has-been-copied-to-google-cloud>Check that the SSL certificate has been copied to Google Cloud<a class=headerlink href=#check-that-the-ssl-certificate-has-been-copied-to-google-cloud title="Permanent link">&para;</a></h3> <p>After cert-manager receives the signed Certificate it stores in the <code>web-ssl</code> Secret, and this in turn triggers the Google Cloud ingress controller to copy that SSL certificate to Google Cloud. You can see the certificate using the <code>gcloud</code> command, as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=gp>$ </span>gcloud compute ssl-certificates list
<a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=go>NAME                                                TYPE          CREATION_TIMESTAMP             EXPIRE_TIME                    MANAGED_STATUS</span>
<a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=go>k8s2-cr-1lt9dzcy-4gjeakdb9n7k6ls7-a257650b5fefd174  SELF_MANAGED  2022-07-14T09:37:06.920-07:00  2022-10-12T08:34:51.000-07:00</span>
</code></pre></div> <p>And you can view its contents and check its attributes as follows:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=gp>$ </span>gcloud compute ssl-certificates describe k8s2-cr-1lt9dzcy-4gjeakdb9n7k6ls7-a257650b5fefd174 --format<span class=o>=</span><span class=s1>&#39;value(certificate)&#39;</span> <span class=se>\</span>
<a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>  <span class=p>|</span> openssl x509 -in - -noout -text
<a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=go>...</span>
<a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=go>Certificate:</span>
<a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=go>    Data:</span>
<a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=go>        Version: 3 (0x2)</span>
<a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=go>        Serial Number:</span>
<a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=go>            04:9f:47:f1:cb:25:37:9b:86:a3:ef:bf:2e:77:3b:45:fc:1a</span>
<a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=go>        Signature Algorithm: sha256WithRSAEncryption</span>
<a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=go>        Issuer: C = US, O = Let&#39;s Encrypt, CN = R3</span>
<a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=go>        Validity</span>
<a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=go>            Not Before: Jul 14 17:11:15 2022 GMT</span>
<a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=go>            Not After : Oct 12 17:11:14 2022 GMT</span>
<a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a><span class=go>        Subject: CN = www.example.com</span>
</code></pre></div> <h3 id=check-the-google-cloud-forwarding-rules>Check the Google Cloud forwarding-rules<a class=headerlink href=#check-the-google-cloud-forwarding-rules title="Permanent link">&para;</a></h3> <p>After you add the TLS stanza to the Ingress object, you should eventually see a forwarding-rule for the SSL connection:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=gp>$ </span>gcloud compute forwarding-rules describe k8s2-fs-1lt9dzcy-default-web-ingress-yteotwe4 --global
<a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=go>IPAddress: 34.120.159.51</span>
<a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=go>IPProtocol: TCP</span>
<a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=go>creationTimestamp: &#39;2022-07-14T09:37:12.362-07:00&#39;</span>
<a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=go>description: &#39;{&quot;kubernetes.io/ingress-name&quot;: &quot;default/web-ingress&quot;}&#39;</span>
<a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=go>fingerprint: oBTg7dRaIqI=</span>
<a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=go>id: &#39;2303318464959215831&#39;</span>
<a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=go>kind: compute#forwardingRule</span>
<a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=go>labelFingerprint: 42WmSpB8rSM=</span>
<a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=go>loadBalancingScheme: EXTERNAL</span>
<a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a><span class=go>name: k8s2-fs-1lt9dzcy-default-web-ingress-yteotwe4</span>
<a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a><span class=go>networkTier: PREMIUM</span>
<a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a><span class=go>portRange: 443-443</span>
<a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a><span class=go>selfLink: https://www.googleapis.com/compute/v1/projects/your-project/global/forwardingRules/k8s2-fs-1lt9dzcy-default-web-ingress-yteotwe4</span>
<a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a><span class=go>target: https://www.googleapis.com/compute/v1/projects/your-project/global/targetHttpsProxies/k8s2-ts-1lt9dzcy-default-web-ingress-yteotwe4</span>
</code></pre></div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Â© 2022 The cert-manager Authors. Â© 2022 The Linux Foundation. All rights reserved. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/cert-manager/cert-manager target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://infosec.exchange/@CertManager target=_blank rel=noopener title=infosec.exchange class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg> </a> <a href=https://twitter.com/CertManager/ target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.5a2dcb6a.min.js></script> </body> </html>